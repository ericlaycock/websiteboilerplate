{"code":"!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.r=function(t){Object.defineProperty(t,\"__esModule\",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=7)}([function(t,e,n){\"use strict\";(function(t){n.d(e,\"a\",function(){return o}),n.d(e,\"b\",function(){return E}),n.d(e,\"c\",function(){return w}),n.d(e,\"d\",function(){return r}),n.d(e,\"e\",function(){return a}),n.d(e,\"f\",function(){return T}),n.d(e,\"g\",function(){return S}),n.d(e,\"h\",function(){return c}),n.d(e,\"i\",function(){return h}),n.d(e,\"j\",function(){return d}),n.d(e,\"k\",function(){return f}),n.d(e,\"l\",function(){return m}),n.d(e,\"m\",function(){return u}),n.d(e,\"n\",function(){return l}),n.d(e,\"o\",function(){return g}),n.d(e,\"p\",function(){return p}),n.d(e,\"q\",function(){return k}),n.d(e,\"r\",function(){return y});\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst i=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++i)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+\"+/=\"},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+\"-_.\"},HAS_NATIVE_SUPPORT:\"function\"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error(\"encodeByteArray takes an array as a parameter\");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let e=0;e<t.length;e+=3){const s=t[e],r=e+1<t.length,o=r?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=s>>2,h=(3&s)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(l=64)),i.push(n[u],n[h],n[l],n[d])}return i.join(\"\")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(i(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=t[n++];e[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(r>>10)),e[i++]=String.fromCharCode(56320+(1023&r))}else{const r=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return e.join(\"\")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],r=e<t.length?n[t.charAt(e)]:0,o=++e<t.length?n[t.charAt(e)]:64,a=++e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==r||null==o||null==a)throw Error();const c=s<<2|r>>4;if(i.push(c),64!==o){const t=r<<4&240|o>>2;if(i.push(t),64!==a){const t=o<<6&192|a;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},r=function(t){return function(t){const e=i(t);return s.encodeByteArray(e,!0)}(t).replace(/\\./g,\"\")};\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass o{constructor(){this.reject=(()=>{}),this.resolve=(()=>{}),this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),\"function\"==typeof t&&(this.promise.catch(()=>{}),1===t.length?t(e):t(e,n))}}}\n/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function a(t,e){if(t.uid)throw new Error('The \"uid\" field is no longer supported by mockUserToken. Please use \"sub\" instead for Firebase Auth User ID.');const n=e||\"demo-project\",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error(\"mockUserToken must contain 'sub' or 'user_id' field!\");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:\"custom\",identities:{}}},t);return[r(JSON.stringify({alg:\"none\",type:\"JWT\"})),r(JSON.stringify(o)),\"\"].join(\".\")}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function c(){return\"undefined\"!=typeof navigator&&\"string\"==typeof navigator.userAgent?navigator.userAgent:\"\"}function u(){return\"undefined\"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(c())}function h(){const t=\"object\"==typeof chrome?chrome.runtime:\"object\"==typeof browser?browser.runtime:void 0;return\"object\"==typeof t&&void 0!==t.id}function l(){return\"object\"==typeof navigator&&\"ReactNative\"===navigator.product}function d(){return c().indexOf(\"Electron/\")>=0}function f(){const t=c();return t.indexOf(\"MSIE \")>=0||t.indexOf(\"Trident/\")>=0}function p(){return c().indexOf(\"MSAppHost/\")>=0}function g(){return!function(){try{return\"[object process]\"===Object.prototype.toString.call(t.process)}catch(t){return!1}}()&&navigator.userAgent.includes(\"Safari\")&&!navigator.userAgent.includes(\"Chrome\")}function m(){return\"object\"==typeof indexedDB}function y(){return new Promise((t,e)=>{try{let n=!0;const i=\"validate-browser-context-for-indexeddb-analytics-module\",s=self.indexedDB.open(i);s.onsuccess=(()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)}),s.onupgradeneeded=(()=>{n=!1}),s.onerror=(()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||\"\")})}catch(t){e(t)}})}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst v=\"FirebaseError\";class w extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=v,Object.setPrototypeOf(this,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,E.prototype.create)}}class E{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,s=this.errors[t],r=s?function(t,e){return t.replace(b,(t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`})}(s,n):\"Error\",o=`${this.serviceName}: ${r} (${i}).`;return new w(i,o,n)}}const b=/\\{\\$([^}]+)}/g;\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function T(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const s of n){if(!i.includes(s))return!1;const n=t[s],r=e[s];if(I(n)&&I(r)){if(!T(n,r))return!1}else if(n!==r)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function I(t){return null!==t&&\"object\"==typeof t}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction S(t){return t&&t._delegate?t._delegate:t}\n/**\n * @license\n * Copyright 2022 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function C(t,e){return new Promise((n,i)=>{t.onsuccess=(t=>{n(t.target.result)}),t.onerror=(t=>{var n;i(`${e}: ${null===(n=t.target.error)||void 0===n?void 0:n.message}`)})})}class _{constructor(t){this._db=t,this.objectStoreNames=this._db.objectStoreNames}transaction(t,e=\"readonly\"){return new A(this._db.transaction.call(this._db,t,e))}createObjectStore(t,e){return new D(this._db.createObjectStore(t,e))}close(){this._db.close()}}class A{constructor(t){this._transaction=t,this.complete=new Promise((t,e)=>{this._transaction.oncomplete=function(){t()},this._transaction.onerror=(()=>{e(this._transaction.error)}),this._transaction.onabort=(()=>{e(this._transaction.error)})})}objectStore(t){return new D(this._transaction.objectStore(t))}}class D{constructor(t){this._store=t}index(t){return new N(this._store.index(t))}createIndex(t,e,n){return new N(this._store.createIndex(t,e,n))}get(t){return C(this._store.get(t),\"Error reading from IndexedDB\")}put(t,e){return C(this._store.put(t,e),\"Error writing to IndexedDB\")}delete(t){return C(this._store.delete(t),\"Error deleting from IndexedDB\")}clear(){return C(this._store.clear(),\"Error clearing IndexedDB object store\")}}class N{constructor(t){this._index=t}get(t){return C(this._index.get(t),\"Error reading from IndexedDB\")}}function k(t,e,n){return new Promise((i,s)=>{try{const r=indexedDB.open(t,e);r.onsuccess=(t=>{i(new _(t.target.result))}),r.onerror=(t=>{var e;s(`Error opening indexedDB: ${null===(e=t.target.error)||void 0===e?void 0:e.message}`)}),r.onupgradeneeded=(t=>{n(new _(r.result),t.oldVersion,t.newVersion,new A(r.transaction))})}catch(t){s(`Error opening indexedDB: ${t.message}`)}})}}).call(this,n(6))},function(t,e,n){\"use strict\";(function(t){n.d(e,\"a\",function(){return ni}),n.d(e,\"b\",function(){return si}),n.d(e,\"c\",function(){return ii}),n.d(e,\"d\",function(){return oi}),n.d(e,\"e\",function(){return ri}),n.d(e,\"f\",function(){return ai}),n.d(e,\"g\",function(){return ci}),n.d(e,\"h\",function(){return ti}),n.d(e,\"i\",function(){return ei});var i,s=\"undefined\"!=typeof globalThis?globalThis:\"undefined\"!=typeof window?window:void 0!==t?t:\"undefined\"!=typeof self?self:{},r={},o=o||{},a=s||self;function c(){}function u(t){var e=typeof t;return\"array\"==(e=\"object\"!=e?e:t?Array.isArray(t)?\"array\":e:\"null\")||\"object\"==e&&\"number\"==typeof t.length}function h(t){var e=typeof t;return\"object\"==e&&null!=t||\"function\"==e}var l=\"closure_uid_\"+(1e9*Math.random()>>>0),d=0;function f(t,e,n){return t.call.apply(t.bind,arguments)}function p(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function g(t,e,n){return(g=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf(\"native code\")?f:p).apply(null,arguments)}function m(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function y(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return e.prototype[n].apply(t,s)}}function v(){this.s=this.s,this.o=this.o}var w={};v.prototype.s=!1,v.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,l)&&t[l]||(t[l]=++d)}(this);delete w[t]}},v.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const E=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(\"string\"==typeof t)return\"string\"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},b=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){const i=t.length,s=\"string\"==typeof t?t.split(\"\"):t;for(let r=0;r<i;r++)r in s&&e.call(n,s[r],r,t)};function T(t){return Array.prototype.concat.apply([],arguments)}function I(t){const e=t.length;if(0<e){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function S(t){return/^[\\s\\xa0]*$/.test(t)}var C,_=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\\s\\xa0]*([\\s\\S]*?)[\\s\\xa0]*$/.exec(t)[1]};function A(t,e){return-1!=t.indexOf(e)}function D(t,e){return t<e?-1:t>e?1:0}t:{var N=a.navigator;if(N){var k=N.userAgent;if(k){C=k;break t}}C=\"\"}function L(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function R(t){const e={};for(const n in t)e[n]=t[n];return e}var O=\"constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf\".split(\" \");function x(t,e){let n,i;for(let e=1;e<arguments.length;e++){for(n in i=arguments[e])t[n]=i[n];for(let e=0;e<O.length;e++)n=O[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function M(t){return M[\" \"](t),t}M[\" \"]=c;var V,P=A(C,\"Opera\"),F=A(C,\"Trident\")||A(C,\"MSIE\"),U=A(C,\"Edge\"),B=U||F,j=A(C,\"Gecko\")&&!(A(C.toLowerCase(),\"webkit\")&&!A(C,\"Edge\"))&&!(A(C,\"Trident\")||A(C,\"MSIE\"))&&!A(C,\"Edge\"),q=A(C.toLowerCase(),\"webkit\")&&!A(C,\"Edge\");function $(){var t=a.document;return t?t.documentMode:void 0}t:{var K=\"\",H=function(){var t=C;return j?/rv:([^\\);]+)(\\)|;)/.exec(t):U?/Edge\\/([\\d\\.]+)/.exec(t):F?/\\b(?:MSIE|rv)[: ]([^\\);]+)(\\)|;)/.exec(t):q?/WebKit\\/(\\S+)/.exec(t):P?/(?:Version)[ \\/]?(\\S+)/.exec(t):void 0}();if(H&&(K=H?H[1]:\"\"),F){var G=$();if(null!=G&&G>parseFloat(K)){V=String(G);break t}}V=K}var z,W={};function Q(){return function(t){var e=W;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}(function(){let t=0;const e=_(String(V)).split(\".\"),n=_(\"9\").split(\".\"),i=Math.max(e.length,n.length);for(let o=0;0==t&&o<i;o++){var s=e[o]||\"\",r=n[o]||\"\";do{if(s=/(\\d*)(\\D*)(.*)/.exec(s)||[\"\",\"\",\"\",\"\"],r=/(\\d*)(\\D*)(.*)/.exec(r)||[\"\",\"\",\"\",\"\"],0==s[0].length&&0==r[0].length)break;t=D(0==s[1].length?0:parseInt(s[1],10),0==r[1].length?0:parseInt(r[1],10))||D(0==s[2].length,0==r[2].length)||D(s[2],r[2]),s=s[3],r=r[3]}while(0==t)}return 0<=t})}if(a.document&&F){var X=$();z=X||(parseInt(V,10)||void 0)}else z=void 0;var Y=z,J=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},\"passive\",{get:function(){t=!0}});try{a.addEventListener(\"test\",c,e),a.removeEventListener(\"test\",c,e)}catch(t){}return t}();function Z(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function tt(t,e){if(Z.call(this,t?t.type:\"\"),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key=\"\",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType=\"\",this.i=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(j){t:{try{M(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else\"mouseover\"==n?e=t.fromElement:\"mouseout\"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||\"\",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=\"string\"==typeof t.pointerType?t.pointerType:et[t.pointerType]||\"\",this.state=t.state,this.i=t,t.defaultPrevented&&tt.Z.h.call(this)}}Z.prototype.h=function(){this.defaultPrevented=!0},y(tt,Z);var et={2:\"touch\",3:\"pen\",4:\"mouse\"};tt.prototype.h=function(){tt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var nt=\"closure_listenable_\"+(1e6*Math.random()|0),it=0;function st(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function rt(t){this.src=t,this.g={},this.h=0}function ot(t,e){var n=e.type;if(n in t.g){var i,s=t.g[n],r=E(s,e);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(st(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function at(t,e,n,i){for(var s=0;s<t.length;++s){var r=t[s];if(!r.ca&&r.listener==e&&r.capture==!!n&&r.ia==i)return s}return-1}rt.prototype.add=function(t,e,n,i,s){var r=t.toString();(t=this.g[r])||(t=this.g[r]=[],this.h++);var o=at(t,e,i,s);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new function(t,e,n,i,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.ia=s,this.key=++it,this.ca=this.fa=!1}(e,this.src,r,!!i,s)).fa=n,t.push(e)),e};var ct=\"closure_lm_\"+(1e6*Math.random()|0),ut={};function ht(t,e,n,i,s){if(i&&i.once)return function t(e,n,i,s,r){if(Array.isArray(n)){for(var o=0;o<n.length;o++)t(e,n[o],i,s,r);return null}i=yt(i);return e&&e[nt]?e.O(n,i,h(s)?!!s.capture:!!s,r):lt(e,n,i,!0,s,r)}(t,e,n,i,s);if(Array.isArray(e)){for(var r=0;r<e.length;r++)ht(t,e[r],n,i,s);return null}return n=yt(n),t&&t[nt]?t.N(e,n,h(i)?!!i.capture:!!i,s):lt(t,e,n,!1,i,s)}function lt(t,e,n,i,s,r){if(!e)throw Error(\"Invalid event type\");var o=h(s)?!!s.capture:!!s,a=gt(t);if(a||(t[ct]=a=new rt(t)),(n=a.add(e,n,i,o,r)).proxy)return n;if(i=function(){var t=pt;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)J||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),i,s);else if(t.attachEvent)t.attachEvent(ft(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error(\"addEventListener and attachEvent are unavailable.\");t.addListener(i)}return n}function dt(t){if(\"number\"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[nt])ot(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(ft(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=gt(e))?(ot(n,t),0==n.h&&(n.src=null,e[ct]=null)):st(t)}}}function ft(t){return t in ut?ut[t]:ut[t]=\"on\"+t}function pt(t,e){if(t.ca)t=!0;else{e=new tt(e,this);var n=t.listener,i=t.ia||t.src;t.fa&&dt(t),t=n.call(i,e)}return t}function gt(t){return(t=t[ct])instanceof rt?t:null}var mt=\"__closure_events_fn_\"+(1e9*Math.random()>>>0);function yt(t){return\"function\"==typeof t?t:(t[mt]||(t[mt]=function(e){return t.handleEvent(e)}),t[mt])}function vt(){v.call(this),this.i=new rt(this),this.P=this,this.I=null}function wt(t,e){var n,i=t.I;if(i)for(n=[];i;i=i.I)n.push(i);if(t=t.P,i=e.type||e,\"string\"==typeof e)e=new Z(e,t);else if(e instanceof Z)e.target=e.target||t;else{var s=e;x(e=new Z(i,t),s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.g=n[r];s=Et(o,i,!0,e)&&s}if(s=Et(o=e.g=t,i,!0,e)&&s,s=Et(o,i,!1,e)&&s,n)for(r=0;r<n.length;r++)s=Et(o=e.g=n[r],i,!1,e)&&s}function Et(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&ot(t.i,o),s=!1!==a.call(c,i)&&s}}return s&&!i.defaultPrevented}y(vt,v),vt.prototype[nt]=!0,vt.prototype.removeEventListener=function(t,e,n,i){!function t(e,n,i,s,r){if(Array.isArray(n))for(var o=0;o<n.length;o++)t(e,n[o],i,s,r);else s=h(s)?!!s.capture:!!s,i=yt(i),e&&e[nt]?(e=e.i,(n=String(n).toString())in e.g&&-1<(i=at(o=e.g[n],i,s,r))&&(st(o[i]),Array.prototype.splice.call(o,i,1),0==o.length&&(delete e.g[n],e.h--))):e&&(e=gt(e))&&(n=e.g[n.toString()],e=-1,n&&(e=at(n,i,s,r)),(i=-1<e?n[e]:null)&&dt(i))}(this,t,e,n,i)},vt.prototype.M=function(){if(vt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],i=0;i<n.length;i++)st(n[i]);delete e.g[t],e.h--}}this.I=null},vt.prototype.N=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},vt.prototype.O=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};var bt=a.JSON.stringify;function Tt(){var t=Dt;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var It,St=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new class{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}},t=>t.reset());function Ct(t){a.setTimeout(()=>{throw t},0)}function _t(t,e){It||function(){var t=a.Promise.resolve(void 0);It=function(){t.then(Nt)}}(),At||(It(),At=!0),Dt.add(t,e)}var At=!1,Dt=new class{constructor(){this.h=this.g=null}add(t,e){const n=St.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function Nt(){for(var t;t=Tt();){try{t.h.call(t.g)}catch(t){Ct(t)}var e=St;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}At=!1}function kt(t,e){vt.call(this),this.h=t||1,this.g=e||a,this.j=g(this.kb,this),this.l=Date.now()}function Lt(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Rt(t,e,n){if(\"function\"==typeof t)n&&(t=g(t,n));else{if(!t||\"function\"!=typeof t.handleEvent)throw Error(\"Invalid listener argument\");t=g(t.handleEvent,t)}return 2147483647<Number(e)?-1:a.setTimeout(t,e||0)}y(kt,vt),(i=kt.prototype).da=!1,i.S=null,i.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),wt(this,\"tick\"),this.da&&(Lt(this),this.start()))}},i.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},i.M=function(){kt.Z.M.call(this),Lt(this),delete this.g};class Ot extends v{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:function t(e){e.g=Rt(()=>{e.g=null,e.i&&(e.i=!1,t(e))},e.j);const n=e.h;e.h=null,e.m.apply(null,n)}(this)}M(){super.M(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function xt(t){v.call(this),this.h=t,this.g={}}y(xt,v);var Mt=[];function Vt(t,e,n,i){Array.isArray(n)||(n&&(Mt[0]=n.toString()),n=Mt);for(var s=0;s<n.length;s++){var r=ht(e,n[s],i||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}}function Pt(t){L(t.g,function(t,e){this.g.hasOwnProperty(e)&&dt(t)},t),t.g={}}function Ft(){this.g=!0}function Ut(t,e,n,i){t.info(function(){return\"XMLHTTP TEXT (\"+e+\"): \"+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var i=n[t];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if(\"noop\"!=r&&\"stop\"!=r&&\"close\"!=r)for(var o=1;o<s.length;o++)s[o]=\"\"}}}return bt(n)}catch(t){return e}}(t,n)+(i?\" \"+i:\"\")})}xt.prototype.M=function(){xt.Z.M.call(this),Pt(this)},xt.prototype.handleEvent=function(){throw Error(\"EventHandler.handleEvent not implemented\")},Ft.prototype.Aa=function(){this.g=!1},Ft.prototype.info=function(){};var Bt={},jt=null;function qt(){return jt=jt||new vt}function $t(t){Z.call(this,Bt.Ma,t)}function Kt(t){const e=qt();wt(e,new $t(e,t))}function Ht(t,e){Z.call(this,Bt.STAT_EVENT,t),this.stat=e}function Gt(t){const e=qt();wt(e,new Ht(e,t))}function zt(t,e){Z.call(this,Bt.Na,t),this.size=e}function Wt(t,e){if(\"function\"!=typeof t)throw Error(\"Fn must not be null and must be a function\");return a.setTimeout(function(){t()},e)}Bt.Ma=\"serverreachability\",y($t,Z),Bt.STAT_EVENT=\"statevent\",y(Ht,Z),Bt.Na=\"timingevent\",y(zt,Z);var Qt={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Xt={qb:\"complete\",Mb:\"success\",Ka:\"error\",Ja:\"abort\",Eb:\"ready\",Fb:\"readystatechange\",TIMEOUT:\"timeout\",Ab:\"incrementaldata\",Db:\"progress\",tb:\"downloadprogress\",Ub:\"uploadprogress\"};function Yt(){}function Jt(t){return t.h||(t.h=t.i())}function Zt(){}Yt.prototype.h=null;var te,ee={OPEN:\"a\",pb:\"b\",Ka:\"c\",Bb:\"d\"};function ne(){Z.call(this,\"d\")}function ie(){Z.call(this,\"c\")}function se(){}function re(t,e,n,i){this.l=t,this.j=e,this.m=n,this.X=i||1,this.V=new xt(this),this.P=ae,t=B?125:void 0,this.W=new kt(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new oe}function oe(){this.i=null,this.g=\"\",this.h=!1}y(ne,Z),y(ie,Z),y(se,Yt),se.prototype.g=function(){return new XMLHttpRequest},se.prototype.i=function(){return{}},te=new se;var ae=45e3,ce={},ue={};function he(t,e,n){t.K=1,t.v=Oe(Ae(e)),t.s=n,t.U=!0,le(t,null)}function le(t,e){t.F=Date.now(),ge(t),t.A=Ae(t.v);var n=t.A,i=t.X;Array.isArray(i)||(i=[String(i)]),Ge(n.h,\"t\",i),t.C=0,n=t.l.H,t.h=new oe,t.g=zn(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Ot(g(t.Ia,t,t.g),t.O)),Vt(t.V,t.g,\"readystatechange\",t.gb),e=t.H?R(t.H):{},t.s?(t.u||(t.u=\"POST\"),e[\"Content-Type\"]=\"application/x-www-form-urlencoded\",t.g.ea(t.A,t.u,t.s,e)):(t.u=\"GET\",t.g.ea(t.A,t.u,null,e)),Kt(1),function(t,e,n,i,s,r){t.info(function(){if(t.g)if(r)for(var o=\"\",a=r.split(\"&\"),c=0;c<a.length;c++){var u=a[c].split(\"=\");if(1<u.length){var h=u[0];u=u[1];var l=h.split(\"_\");o=2<=l.length&&\"type\"==l[1]?o+(h+\"=\")+u+\"&\":o+(h+\"=redacted&\")}}else o=null;else o=r;return\"XMLHTTP REQ (\"+i+\") [attempt \"+s+\"]: \"+e+\"\\n\"+n+\"\\n\"+o})}(t.j,t.u,t.A,t.m,t.X,t.s)}function de(t){return!!t.g&&(\"GET\"==t.u&&2!=t.K&&t.l.Ba)}function fe(t,e,n){let i,s=!0;for(;!t.I&&t.C<n.length;){if((i=pe(t,n))==ue){4==e&&(t.o=4,Gt(14),s=!1),Ut(t.j,t.m,null,\"[Incomplete Response]\");break}if(i==ce){t.o=4,Gt(15),Ut(t.j,t.m,n,\"[Invalid Chunk]\"),s=!1;break}Ut(t.j,t.m,i,null),Ee(t,i)}de(t)&&i!=ue&&i!=ce&&(t.h.g=\"\",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Gt(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info(\"Great, no buffering proxy detected. Bytes received: \"+n.length),Un(e),e.L=!0,Gt(11))):(Ut(t.j,t.m,n,\"[Invalid Chunked Response]\"),we(t),ve(t))}function pe(t,e){var n=t.C,i=e.indexOf(\"\\n\",n);return-1==i?ue:(n=Number(e.substring(n,i)),isNaN(n)?ce:(i+=1)+n>e.length?ue:(e=e.substr(i,n),t.C=i+n,e))}function ge(t){t.Y=Date.now()+t.P,me(t,t.P)}function me(t,e){if(null!=t.B)throw Error(\"WatchDog timer not null\");t.B=Wt(g(t.eb,t),e)}function ye(t){t.B&&(a.clearTimeout(t.B),t.B=null)}function ve(t){0==t.l.G||t.I||qn(t.l,t)}function we(t){ye(t);var e=t.L;e&&\"function\"==typeof e.na&&e.na(),t.L=null,Lt(t.W),Pt(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Ee(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Ze(n.i,t)))if(n.I=t.N,!t.J&&Ze(n.i,t)&&3==n.G){try{var i=n.Ca.g.parse(e)}catch(t){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;jn(n),kn(n)}Fn(n),Gt(18)}}else n.ta=s[1],0<n.ta-n.U&&37500>s[2]&&n.N&&0==n.A&&!n.v&&(n.v=Wt(g(n.ab,n),6e3));if(1>=Je(n.i)&&n.ka){try{n.ka()}catch(t){}n.ka=void 0}}else Kn(n,11)}else if((t.J||n.g==t)&&jn(n),!S(e))for(s=n.Ca.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(n.U=u[0],u=u[1],2==n.G)if(\"c\"==u[0]){n.J=u[1],n.la=u[2];const e=u[3];null!=e&&(n.ma=e,n.h.info(\"VER=\"+n.ma));const s=u[4];null!=s&&(n.za=s,n.h.info(\"SVER=\"+n.za));const h=u[5];null!=h&&\"number\"==typeof h&&0<h&&(i=1.5*h,n.K=i,n.h.info(\"backChannelRequestTimeoutMs_=\"+i)),i=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader(\"X-Client-Wire-Protocol\"):null;if(t){var r=i.i;!r.g&&(A(t,\"spdy\")||A(t,\"quic\")||A(t,\"h2\"))&&(r.j=r.l,r.g=new Set,r.h&&(tn(r,r.h),r.h=null))}if(i.D){const t=l.g?l.g.getResponseHeader(\"X-HTTP-Session-Id\"):null;t&&(i.sa=t,Re(i.F,i.D,t))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info(\"Handshake RTT: \"+n.O+\"ms\"));var o=t;if((i=n).oa=Gn(i,i.H?i.la:null,i.W),o.J){en(i.i,o);var a=o,c=i.K;c&&a.setTimeout(c),a.B&&(ye(a),ge(a)),i.g=o}else Pn(i);0<n.l.length&&On(n)}else\"stop\"!=u[0]&&\"close\"!=u[0]||Kn(n,7);else 3==n.G&&(\"stop\"==u[0]||\"close\"==u[0]?\"stop\"==u[0]?Kn(n,7):Nn(n):\"noop\"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}Kt(4)}catch(t){}}function be(t,e){if(t.forEach&&\"function\"==typeof t.forEach)t.forEach(e,void 0);else if(u(t)||\"string\"==typeof t)b(t,e,void 0);else{if(t.T&&\"function\"==typeof t.T)var n=t.T();else if(t.R&&\"function\"==typeof t.R)n=void 0;else if(u(t)||\"string\"==typeof t){n=[];for(var i=t.length,s=0;s<i;s++)n.push(s)}else for(s in n=[],i=0,t)n[i++]=s;s=(i=function(t){if(t.R&&\"function\"==typeof t.R)return t.R();if(\"string\"==typeof t)return t.split(\"\");if(u(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}(t)).length;for(var r=0;r<s;r++)e.call(void 0,i[r],n&&n[r],t)}}function Te(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error(\"Uneven number of arguments\");for(var i=0;i<n;i+=2)this.set(arguments[i],arguments[i+1])}else if(t)if(t instanceof Te)for(n=t.T(),i=0;i<n.length;i++)this.set(n[i],t.get(n[i]));else for(i in t)this.set(i,t[i])}function Ie(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var i=t.g[e];Se(t.h,i)&&(t.g[n++]=i),e++}t.g.length=n}if(t.i!=t.g.length){var s={};for(n=e=0;e<t.g.length;)Se(s,i=t.g[e])||(t.g[n++]=i,s[i]=1),e++;t.g.length=n}}function Se(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(i=re.prototype).setTimeout=function(t){this.P=t},i.gb=function(t){t=t.target;const e=this.L;e&&3==Sn(t)?e.l():this.Ia(t)},i.Ia=function(t){try{if(t==this.g)t:{const l=Sn(this.g);var e=this.g.Da();const d=this.g.ba();if(!(3>l)&&(3!=l||B||this.g&&(this.h.h||this.g.ga()||Cn(this.g)))){this.I||4!=l||7==e||Kt(8==e||0>=d?3:2),ye(this);var n=this.g.ba();this.N=n;e:if(de(this)){var i=Cn(this.g);t=\"\";var s=i.length,r=4==Sn(this.g);if(!this.h.i){if(\"undefined\"==typeof TextDecoder){we(this),ve(this);var o=\"\";break e}this.h.i=new a.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(i[e],{stream:r&&e==s-1});i.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(t,e,n,i,s,r,o){t.info(function(){return\"XMLHTTP RESP (\"+i+\") [ attempt \"+s+\"]: \"+e+\"\\n\"+n+\"\\n\"+r+\" \"+o})}(this.j,this.u,this.A,this.m,this.X,l,n),this.i){if(this.$&&!this.J){e:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader(\"X-HTTP-Initial-Response\"):null)&&!S(c)){var h=c;break e}}h=null}if(!(n=h)){this.i=!1,this.o=3,Gt(12),we(this),ve(this);break t}Ut(this.j,this.m,n,\"Initial handshake response via X-HTTP-Initial-Response\"),this.J=!0,Ee(this,n)}this.U?(fe(this,l,o),B&&this.i&&3==l&&(Vt(this.V,this.W,\"tick\",this.fb),this.W.start())):(Ut(this.j,this.m,o,null),Ee(this,o)),4==l&&we(this),this.i&&!this.I&&(4==l?qn(this.l,this):(this.i=!1,ge(this)))}else 400==n&&0<o.indexOf(\"Unknown SID\")?(this.o=3,Gt(12)):(this.o=0,Gt(13)),we(this),ve(this)}}}catch(t){}},i.fb=function(){if(this.g){var t=Sn(this.g),e=this.g.ga();this.C<e.length&&(ye(this),fe(this,t,e),this.i&&4!=t&&ge(this))}},i.cancel=function(){this.I=!0,we(this)},i.eb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info(function(){return\"TIMEOUT: \"+e})}(this.j,this.A),2!=this.K&&(Kt(3),Gt(17)),we(this),this.o=2,ve(this)):me(this,this.Y-t)},(i=Te.prototype).R=function(){Ie(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},i.T=function(){return Ie(this),this.g.concat()},i.get=function(t,e){return Se(this.h,t)?this.h[t]:e},i.set=function(t,e){Se(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},i.forEach=function(t,e){for(var n=this.T(),i=0;i<n.length;i++){var s=n[i],r=this.get(s);t.call(e,r,s,this)}};var Ce=/^(?:([^:/?#.]+):)?(?:\\/\\/(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$/;function _e(t,e){if(this.i=this.s=this.j=\"\",this.m=null,this.o=this.l=\"\",this.g=!1,t instanceof _e){this.g=void 0!==e?e:t.g,De(this,t.j),this.s=t.s,Ne(this,t.i),ke(this,t.m),this.l=t.l,e=t.h;var n=new qe;n.i=e.i,e.g&&(n.g=new Te(e.g),n.h=e.h),Le(this,n),this.o=t.o}else t&&(n=String(t).match(Ce))?(this.g=!!e,De(this,n[1]||\"\",!0),this.s=xe(n[2]||\"\"),Ne(this,n[3]||\"\",!0),ke(this,n[4]),this.l=xe(n[5]||\"\",!0),Le(this,n[6]||\"\",!0),this.o=xe(n[7]||\"\")):(this.g=!!e,this.h=new qe(null,this.g))}function Ae(t){return new _e(t)}function De(t,e,n){t.j=n?xe(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,\"\"))}function Ne(t,e,n){t.i=n?xe(e,!0):e}function ke(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error(\"Bad port number \"+e);t.m=e}else t.m=null}function Le(t,e,n){e instanceof qe?(t.h=e,function(t,e){e&&!t.j&&($e(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Ke(this,e),Ge(this,n,t))},t)),t.j=e}(t.h,t.g)):(n||(e=Me(e,Be)),t.h=new qe(e,t.g))}function Re(t,e,n){t.h.set(e,n)}function Oe(t){return Re(t,\"zx\",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function xe(t,e){return t?e?decodeURI(t.replace(/%25/g,\"%2525\")):decodeURIComponent(t):\"\"}function Me(t,e,n){return\"string\"==typeof t?(t=encodeURI(t).replace(e,Ve),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,\"%$1\")),t):null}function Ve(t){return\"%\"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}_e.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Me(e,Pe,!0),\":\");var n=this.i;return(n||\"file\"==e)&&(t.push(\"//\"),(e=this.s)&&t.push(Me(e,Pe,!0),\"@\"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,\"%$1\")),null!=(n=this.m)&&t.push(\":\",String(n))),(n=this.l)&&(this.i&&\"/\"!=n.charAt(0)&&t.push(\"/\"),t.push(Me(n,\"/\"==n.charAt(0)?Ue:Fe,!0))),(n=this.h.toString())&&t.push(\"?\",n),(n=this.o)&&t.push(\"#\",Me(n,je)),t.join(\"\")};var Pe=/[#\\/\\?@]/g,Fe=/[#\\?:]/g,Ue=/[#\\?]/g,Be=/[#\\?@]/g,je=/#/g;function qe(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function $e(t){t.g||(t.g=new Te,t.h=0,t.i&&function(t,e){if(t){t=t.split(\"&\");for(var n=0;n<t.length;n++){var i=t[n].indexOf(\"=\"),s=null;if(0<=i){var r=t[n].substring(0,i);s=t[n].substring(i+1)}else r=t[n];e(r,s?decodeURIComponent(s.replace(/\\+/g,\" \")):\"\")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\\+/g,\" \")),n)}))}function Ke(t,e){$e(t),e=ze(t,e),Se(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Se((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Ie(t)))}function He(t,e){return $e(t),e=ze(t,e),Se(t.g.h,e)}function Ge(t,e,n){Ke(t,e),0<n.length&&(t.i=null,t.g.set(ze(t,e),I(n)),t.h+=n.length)}function ze(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(i=qe.prototype).add=function(t,e){$e(this),this.i=null,t=ze(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},i.forEach=function(t,e){$e(this),this.g.forEach(function(n,i){b(n,function(n){t.call(e,n,i,this)},this)},this)},i.T=function(){$e(this);for(var t=this.g.R(),e=this.g.T(),n=[],i=0;i<e.length;i++)for(var s=t[i],r=0;r<s.length;r++)n.push(e[i]);return n},i.R=function(t){$e(this);var e=[];if(\"string\"==typeof t)He(this,t)&&(e=T(e,this.g.get(ze(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=T(e,t[n])}return e},i.set=function(t,e){return $e(this),this.i=null,He(this,t=ze(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},i.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},i.toString=function(){if(this.i)return this.i;if(!this.g)return\"\";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var i=e[n],s=encodeURIComponent(String(i));i=this.R(i);for(var r=0;r<i.length;r++){var o=s;\"\"!==i[r]&&(o+=\"=\"+encodeURIComponent(String(i[r]))),t.push(o)}}return this.i=t.join(\"&\")};var We=class{constructor(t,e){this.h=t,this.g=e}};function Qe(t){this.l=t||Xe,a.PerformanceNavigationTiming?t=0<(t=a.performance.getEntriesByType(\"navigation\")).length&&(\"hq\"==t[0].nextHopProtocol||\"h2\"==t[0].nextHopProtocol):t=!!(a.g&&a.g.Ea&&a.g.Ea()&&a.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Xe=10;function Ye(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Je(t){return t.h?1:t.g?t.g.size:0}function Ze(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function tn(t,e){t.g?t.g.add(e):t.h=e}function en(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function nn(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return I(t.i)}function sn(){}function rn(t,e,n){const i=n||\"\";try{be(t,function(t,n){let s=t;h(t)&&(s=bt(t)),e.push(i+n+\"=\"+encodeURIComponent(s))})}catch(t){throw e.push(i+\"type=\"+encodeURIComponent(\"_badmap\")),t}}function on(t,e,n,i,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(i)}catch(t){}}function an(t){this.l=t.$b||null,this.j=t.ib||!1}function cn(t,e){vt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=un,this.status=0,this.responseType=this.responseText=this.response=this.statusText=\"\",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C=\"GET\",this.B=\"\",this.g=!1,this.A=this.j=this.l=null}Qe.prototype.cancel=function(){if(this.i=nn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},sn.prototype.stringify=function(t){return a.JSON.stringify(t,void 0)},sn.prototype.parse=function(t){return a.JSON.parse(t,void 0)},y(an,Yt),an.prototype.g=function(){return new cn(this.l,this.j)},an.prototype.i=function(t){return function(){return t}}({}),y(cn,vt);var un=0;function hn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function ln(t){t.readyState=4,t.l=null,t.j=null,t.A=null,dn(t)}function dn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(i=cn.prototype).open=function(t,e){if(this.readyState!=un)throw this.abort(),Error(\"Error reopening a connection\");this.C=t,this.B=e,this.readyState=1,dn(this)},i.send=function(t){if(1!=this.readyState)throw this.abort(),Error(\"need to call open() first. \");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||a).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},i.abort=function(){this.response=this.responseText=\"\",this.v=new Headers,this.status=0,this.j&&this.j.cancel(\"Request was aborted.\"),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ln(this)),this.readyState=un},i.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,dn(this)),this.g&&(this.readyState=3,dn(this),this.g)))if(\"arraybuffer\"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==a.ReadableStream&&\"body\"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for \"streamBinaryChunks\" mode responses.');this.response=[]}else this.response=this.responseText=\"\",this.A=new TextDecoder;hn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},i.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?ln(this):dn(this),3==this.readyState&&hn(this)}},i.Ua=function(t){this.g&&(this.response=this.responseText=t,ln(this))},i.Ta=function(t){this.g&&(this.response=t,ln(this))},i.ha=function(){this.g&&ln(this)},i.setRequestHeader=function(t,e){this.v.append(t,e)},i.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||\"\"},i.getAllResponseHeaders=function(){if(!this.h)return\"\";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+\": \"+n[1]),n=e.next();return t.join(\"\\r\\n\")},Object.defineProperty(cn.prototype,\"withCredentials\",{get:function(){return\"include\"===this.m},set:function(t){this.m=t?\"include\":\"same-origin\"}});var fn=a.JSON.parse;function pn(t){vt.call(this),this.headers=new Te,this.u=t||null,this.h=!1,this.C=this.g=null,this.H=\"\",this.m=0,this.j=\"\",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=gn,this.K=this.L=!1}y(pn,vt);var gn=\"\",mn=/^https?$/i,yn=[\"POST\",\"PUT\"];function vn(t){return\"content-type\"==t.toLowerCase()}function wn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,En(t),Tn(t)}function En(t){t.D||(t.D=!0,wt(t,\"complete\"),wt(t,\"error\"))}function bn(t){if(t.h&&void 0!==o&&(!t.C[1]||4!=Sn(t)||2!=t.ba()))if(t.v&&4==Sn(t))Rt(t.Fa,0,t);else if(wt(t,\"readystatechange\"),4==Sn(t)){t.h=!1;try{const o=t.ba();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===o){var s=String(t.H).match(Ce)[1]||null;if(!s&&a.self&&a.self.location){var r=a.self.location.protocol;s=r.substr(0,r.length-1)}i=!mn.test(s?s.toLowerCase():\"\")}n=i}if(n)wt(t,\"complete\"),wt(t,\"success\");else{t.m=6;try{var c=2<Sn(t)?t.g.statusText:\"\"}catch(t){c=\"\"}t.j=c+\" [\"+t.ba()+\"]\",En(t)}}finally{Tn(t)}}}function Tn(t,e){if(t.g){In(t);const n=t.g,i=t.C[0]?c:null;t.g=null,t.C=null,e||wt(t,\"ready\");try{n.onreadystatechange=i}catch(t){}}}function In(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(a.clearTimeout(t.A),t.A=null)}function Sn(t){return t.g?t.g.readyState:0}function Cn(t){try{if(!t.g)return null;if(\"response\"in t.g)return t.g.response;switch(t.J){case gn:case\"text\":return t.g.responseText;case\"arraybuffer\":if(\"mozResponseArrayBuffer\"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function _n(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=function(t){let e=\"\";return L(t,function(t,n){e+=n,e+=\":\",e+=t,e+=\"\\r\\n\"}),e}(n),\"string\"==typeof t?null!=n&&encodeURIComponent(String(n)):Re(t,e,n))}function An(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Dn(t){this.za=0,this.l=[],this.h=new Ft,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=An(\"failFast\",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=An(\"baseRetryDelayMs\",5e3,t),this.$a=An(\"retryDelaySeedMs\",1e4,t),this.Ya=An(\"forwardChannelMaxRetries\",2,t),this.ra=An(\"forwardChannelRequestTimeoutMs\",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J=\"\",this.i=new Qe(t&&t.concurrentRequestLimit),this.Ca=new function(){this.g=new sn},this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Nn(t){if(Ln(t),3==t.G){var e=t.V++,n=Ae(t.F);Re(n,\"SID\",t.J),Re(n,\"RID\",e),Re(n,\"TYPE\",\"terminate\"),Mn(t,n),(e=new re(t,t.h,e,void 0)).K=2,e.v=Oe(Ae(n)),n=!1,a.navigator&&a.navigator.sendBeacon&&(n=a.navigator.sendBeacon(e.v.toString(),\"\")),!n&&a.Image&&((new Image).src=e.v,n=!0),n||(e.g=zn(e.l,null),e.g.ea(e.v)),e.F=Date.now(),ge(e)}Hn(t)}function kn(t){t.g&&(Un(t),t.g.cancel(),t.g=null)}function Ln(t){kn(t),t.u&&(a.clearTimeout(t.u),t.u=null),jn(t),t.i.cancel(),t.m&&(\"number\"==typeof t.m&&a.clearTimeout(t.m),t.m=null)}function Rn(t,e){t.l.push(new We(t.Za++,e)),3==t.G&&On(t)}function On(t){Ye(t.i)||t.m||(t.m=!0,_t(t.Ha,t),t.C=0)}function xn(t,e){var n;n=e?e.m:t.V++;const i=Ae(t.F);Re(i,\"SID\",t.J),Re(i,\"RID\",n),Re(i,\"AID\",t.U),Mn(t,i),t.o&&t.s&&_n(i,t.o,t.s),n=new re(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Vn(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),tn(t.i,n),he(n,i,e)}function Mn(t,e){t.j&&be({},function(t,n){Re(e,n,t)})}function Vn(t,e,n){n=Math.min(t.l.length,n);var i=t.j?g(t.j.Oa,t.j,t):null;t:{var s=t.l;let e=-1;for(;;){const t=[\"count=\"+n];-1==e?0<n?(e=s[0].h,t.push(\"ofs=\"+e)):e=0:t.push(\"ofs=\"+e);let r=!0;for(let o=0;o<n;o++){let n=s[o].h;const a=s[o].g;if(0>(n-=e))e=Math.max(0,s[o].h-100),r=!1;else try{rn(a,t,\"req\"+n+\"_\")}catch(t){i&&i(a)}}if(r){i=t.join(\"&\");break t}}}return t=t.l.splice(0,n),e.D=t,i}function Pn(t){t.g||t.u||(t.Y=1,_t(t.Ga,t),t.A=0)}function Fn(t){return!(t.g||t.u||3<=t.A)&&(t.Y++,t.u=Wt(g(t.Ga,t),$n(t,t.A)),t.A++,!0)}function Un(t){null!=t.B&&(a.clearTimeout(t.B),t.B=null)}function Bn(t){t.g=new re(t,t.h,\"rpc\",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Ae(t.oa);Re(e,\"RID\",\"rpc\"),Re(e,\"SID\",t.J),Re(e,\"CI\",t.N?\"0\":\"1\"),Re(e,\"AID\",t.U),Mn(t,e),Re(e,\"TYPE\",\"xmlhttp\"),t.o&&t.s&&_n(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Oe(Ae(e)),n.s=null,n.U=!0,le(n,t)}function jn(t){null!=t.v&&(a.clearTimeout(t.v),t.v=null)}function qn(t,e){var n=null;if(t.g==e){jn(t),Un(t),t.g=null;var i=2}else{if(!Ze(t.i,e))return;n=e.D,en(t.i,e),i=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==i){n=e.s?e.s.length:0,e=Date.now()-e.F;var s=t.C;wt(i=qt(),new zt(i,n,e,s)),On(t)}else Pn(t);else if(3==(s=e.o)||0==s&&0<t.I||!(1==i&&function(t,e){return!(Je(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Wt(g(t.Ha,t,e),$n(t,t.C)),t.C++,0)))}(t,e)||2==i&&Fn(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:Kn(t,5);break;case 4:Kn(t,10);break;case 3:Kn(t,6);break;default:Kn(t,2)}}function $n(t,e){let n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Kn(t,e){if(t.h.info(\"Error code \"+e),2==e){var n=null;t.j&&(n=null);var i=g(t.jb,t);n||(n=new _e(\"//www.google.com/images/cleardot.gif\"),a.location&&\"http\"==a.location.protocol||De(n,\"https\"),Oe(n)),function(t,e){const n=new Ft;if(a.Image){const i=new Image;i.onload=m(on,n,i,\"TestLoadImage: loaded\",!0,e),i.onerror=m(on,n,i,\"TestLoadImage: error\",!1,e),i.onabort=m(on,n,i,\"TestLoadImage: abort\",!1,e),i.ontimeout=m(on,n,i,\"TestLoadImage: timeout\",!1,e),a.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=t}else e(!1)}(n.toString(),i)}else Gt(2);t.G=0,t.j&&t.j.va(e),Hn(t),Ln(t)}function Hn(t){t.G=0,t.I=-1,t.j&&(0==nn(t.i).length&&0==t.l.length||(t.i.i.length=0,I(t.l),t.l.length=0),t.j.ua())}function Gn(t,e,n){let i=function(t){return t instanceof _e?Ae(t):new _e(t,void 0)}(n);if(\"\"!=i.i)e&&Ne(i,e+\".\"+i.i),ke(i,i.m);else{const t=a.location;i=function(t,e,n,i){var s=new _e(null,void 0);return t&&De(s,t),e&&Ne(s,e),n&&ke(s,n),i&&(s.l=i),s}(t.protocol,e?e+\".\"+t.hostname:t.hostname,+t.port,n)}return t.aa&&L(t.aa,function(t,e){Re(i,e,t)}),e=t.D,n=t.sa,e&&n&&Re(i,e,n),Re(i,\"VER\",t.ma),Mn(t,i),i}function zn(t,e,n){if(e&&!t.H)throw Error(\"Can't create secondary domain capable XhrIo object.\");return(e=n&&t.Ba&&!t.qa?new pn(new an({ib:!0})):new pn(t.qa)).L=t.H,e}function Wn(){}function Qn(){if(F&&!(10<=Number(Y)))throw Error(\"Environmental error: no available transport.\")}function Xn(t,e){vt.call(this),this.g=new Dn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t[\"X-Client-Protocol\"]=\"webchannel\":t={\"X-Client-Protocol\":\"webchannel\"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t[\"X-WebChannel-Content-Type\"]=e.messageContentType:t={\"X-WebChannel-Content-Type\":e.messageContentType}),e&&e.ya&&(t?t[\"X-WebChannel-Client-Profile\"]=e.ya:t={\"X-WebChannel-Client-Profile\":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!S(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!S(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new Zn(this)}function Yn(t){ne.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Jn(){ie.call(this),this.status=1}function Zn(t){this.g=t}(i=pn.prototype).ea=function(t,e,n,i){if(this.g)throw Error(\"[goog.net.XhrIo] Object is active with another request=\"+this.H+\"; newUri=\"+t);e=e?e.toUpperCase():\"GET\",this.H=t,this.j=\"\",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():te.g(),this.C=this.u?Jt(this.u):Jt(te),this.g.onreadystatechange=g(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void wn(this,t)}t=n||\"\";const s=new Te(this.headers);i&&be(i,function(t,e){s.set(e,t)}),i=function(t){t:{var e=vn;const n=t.length,i=\"string\"==typeof t?t.split(\"\"):t;for(let s=0;s<n;s++)if(s in i&&e.call(void 0,i[s],s,t)){e=s;break t}e=-1}return 0>e?null:\"string\"==typeof t?t.charAt(e):t[e]}(s.T()),n=a.FormData&&t instanceof a.FormData,!(0<=E(yn,e))||i||n||s.set(\"Content-Type\",\"application/x-www-form-urlencoded;charset=utf-8\"),s.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),\"withCredentials\"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{In(this),0<this.B&&((this.K=function(t){return F&&Q()&&\"number\"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=g(this.pa,this)):this.A=Rt(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){wn(this,t)}},i.pa=function(){void 0!==o&&this.g&&(this.j=\"Timed out after \"+this.B+\"ms, aborting\",this.m=8,wt(this,\"timeout\"),this.abort(8))},i.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,wt(this,\"complete\"),wt(this,\"abort\"),Tn(this))},i.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Tn(this,!0)),pn.Z.M.call(this)},i.Fa=function(){this.s||(this.F||this.v||this.l?bn(this):this.cb())},i.cb=function(){bn(this)},i.ba=function(){try{return 2<Sn(this)?this.g.status:-1}catch(t){return-1}},i.ga=function(){try{return this.g?this.g.responseText:\"\"}catch(t){return\"\"}},i.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),fn(e)}},i.Da=function(){return this.m},i.La=function(){return\"string\"==typeof this.j?this.j:String(this.j)},(i=Dn.prototype).ma=8,i.G=1,i.hb=function(t){try{this.h.info(\"Origin Trials invoked: \"+t)}catch(t){}},i.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const s=new re(this,this.h,t,void 0);let r=this.s;if(this.P&&(r?x(r=R(r),this.P):r=this.P),null===this.o&&(s.H=r),this.ja)t:{for(var e=0,n=0;n<this.l.length;n++){var i=this.l[n];if(void 0===(i=\"__data__\"in i.g&&\"string\"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=n;break t}if(4096===e||n===this.l.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Vn(this,s,e),Re(n=Ae(this.F),\"RID\",t),Re(n,\"CVER\",22),this.D&&Re(n,\"X-HTTP-Session-Id\",this.D),Mn(this,n),this.o&&r&&_n(n,this.o,r),tn(this.i,s),this.Ra&&Re(n,\"TYPE\",\"init\"),this.ja?(Re(n,\"$req\",e),Re(n,\"SID\",\"null\"),s.$=!0,he(s,n,null)):he(s,n,e),this.G=2}}else 3==this.G&&(t?xn(this,t):0==this.l.length||Ye(this.i)||xn(this))},i.Ga=function(){if(this.u=null,Bn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info(\"BP detection timer enabled: \"+t),this.B=Wt(g(this.bb,this),t)}},i.bb=function(){this.B&&(this.B=null,this.h.info(\"BP detection timeout reached.\"),this.h.info(\"Buffering proxy detected and switch to long-polling!\"),this.N=!1,this.L=!0,Gt(10),kn(this),Bn(this))},i.ab=function(){null!=this.v&&(this.v=null,kn(this),Fn(this),Gt(19))},i.jb=function(t){t?(this.h.info(\"Successfully pinged google.com\"),Gt(2)):(this.h.info(\"Failed to ping google.com\"),Gt(1))},(i=Wn.prototype).xa=function(){},i.wa=function(){},i.va=function(){},i.ua=function(){},i.Oa=function(){},Qn.prototype.g=function(t,e){return new Xn(t,e)},y(Xn,vt),Xn.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info(\"Origin Trials enabled.\"),_t(g(t.hb,t,e))),Gt(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=Gn(t,null,t.W),On(t)},Xn.prototype.close=function(){Nn(this.g)},Xn.prototype.u=function(t){if(\"string\"==typeof t){var e={};e.__data__=t,Rn(this.g,e)}else this.v?((e={}).__data__=bt(t),Rn(this.g,e)):Rn(this.g,t)},Xn.prototype.M=function(){this.g.j=null,delete this.j,Nn(this.g),delete this.g,Xn.Z.M.call(this)},y(Yn,ne),y(Jn,ie),y(Zn,Wn),Zn.prototype.xa=function(){wt(this.g,\"a\")},Zn.prototype.wa=function(t){wt(this.g,new Yn(t))},Zn.prototype.va=function(t){wt(this.g,new Jn(t))},Zn.prototype.ua=function(){wt(this.g,\"b\")},Qn.prototype.createWebChannel=Qn.prototype.g,Xn.prototype.send=Xn.prototype.u,Xn.prototype.open=Xn.prototype.m,Xn.prototype.close=Xn.prototype.close,Qt.NO_ERROR=0,Qt.TIMEOUT=8,Qt.HTTP_ERROR=6,Xt.COMPLETE=\"complete\",Zt.EventType=ee,ee.OPEN=\"a\",ee.CLOSE=\"b\",ee.ERROR=\"c\",ee.MESSAGE=\"d\",vt.prototype.listen=vt.prototype.N,pn.prototype.listenOnce=pn.prototype.O,pn.prototype.getLastError=pn.prototype.La,pn.prototype.getLastErrorCode=pn.prototype.Da,pn.prototype.getStatus=pn.prototype.ba,pn.prototype.getResponseJson=pn.prototype.Qa,pn.prototype.getResponseText=pn.prototype.ga,pn.prototype.send=pn.prototype.ea;var ti=r.createWebChannelTransport=function(){return new Qn},ei=r.getStatEventTarget=function(){return qt()},ni=r.ErrorCode=Qt,ii=r.EventType=Xt,si=r.Event=Bt,ri=r.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},oi=r.FetchXmlHttpFactory=an,ai=r.WebChannel=Zt,ci=r.XhrIo=pn}).call(this,n(6))},function(t,e,n){\"use strict\";n.d(e,\"a\",function(){return b}),n.d(e,\"b\",function(){return m}),n.d(e,\"c\",function(){return g}),n.d(e,\"d\",function(){return y}),n.d(e,\"e\",function(){return I}),n.d(e,\"f\",function(){return T}),n.d(e,\"g\",function(){return S});var i=n(4),s=n(3),r=n(0);\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass o{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function(t){const e=t.getComponent();return\"VERSION\"===(null===e||void 0===e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null}).filter(t=>t).join(\" \")}}const a=\"@firebase/app\",c=\"0.7.22\",u=new s.b(\"@firebase/app\"),h=\"[DEFAULT]\",l={[a]:\"fire-core\",\"@firebase/app-compat\":\"fire-core-compat\",\"@firebase/analytics\":\"fire-analytics\",\"@firebase/analytics-compat\":\"fire-analytics-compat\",\"@firebase/app-check\":\"fire-app-check\",\"@firebase/app-check-compat\":\"fire-app-check-compat\",\"@firebase/auth\":\"fire-auth\",\"@firebase/auth-compat\":\"fire-auth-compat\",\"@firebase/database\":\"fire-rtdb\",\"@firebase/database-compat\":\"fire-rtdb-compat\",\"@firebase/functions\":\"fire-fn\",\"@firebase/functions-compat\":\"fire-fn-compat\",\"@firebase/installations\":\"fire-iid\",\"@firebase/installations-compat\":\"fire-iid-compat\",\"@firebase/messaging\":\"fire-fcm\",\"@firebase/messaging-compat\":\"fire-fcm-compat\",\"@firebase/performance\":\"fire-perf\",\"@firebase/performance-compat\":\"fire-perf-compat\",\"@firebase/remote-config\":\"fire-rc\",\"@firebase/remote-config-compat\":\"fire-rc-compat\",\"@firebase/storage\":\"fire-gcs\",\"@firebase/storage-compat\":\"fire-gcs-compat\",\"@firebase/firestore\":\"fire-fst\",\"@firebase/firestore-compat\":\"fire-fst-compat\",\"fire-js\":\"fire-js\",firebase:\"fire-js-all\"},d=new Map,f=new Map;function p(t,e){try{t.container.addComponent(e)}catch(n){u.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function g(t){const e=t.name;if(f.has(e))return u.debug(`There were multiple attempts to register component ${e}.`),!1;f.set(e,t);for(const e of d.values())p(e,t);return!0}function m(t,e){const n=t.container.getProvider(\"heartbeat\").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function y(t,e,n=h){m(t,e).clearInstance(n)}\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst v={\"no-app\":\"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()\",\"bad-app-name\":\"Illegal App name: '{$appName}\",\"duplicate-app\":\"Firebase App named '{$appName}' already exists with different options or config\",\"app-deleted\":\"Firebase App named '{$appName}' already deleted\",\"invalid-app-argument\":\"firebase.{$appName}() takes either no argument or a Firebase App instance.\",\"invalid-log-argument\":\"First argument to `onLog` must be null or a function.\",\"storage-open\":\"Error thrown when opening storage. Original error: {$originalErrorMessage}.\",\"storage-get\":\"Error thrown when reading from storage. Original error: {$originalErrorMessage}.\",\"storage-set\":\"Error thrown when writing to storage. Original error: {$originalErrorMessage}.\",\"storage-delete\":\"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.\"},w=new r.b(\"app\",\"Firebase\",v);\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass E{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new i.a(\"app\",()=>this,\"PUBLIC\"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw w.create(\"app-deleted\",{appName:this._name})}}\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */const b=\"9.7.0\";function T(t,e={}){if(\"object\"!=typeof e){e={name:e}}const n=Object.assign({name:h,automaticDataCollectionEnabled:!1},e),s=n.name;if(\"string\"!=typeof s||!s)throw w.create(\"bad-app-name\",{appName:String(s)});const o=d.get(s);if(o){if(Object(r.f)(t,o.options)&&Object(r.f)(n,o.config))return o;throw w.create(\"duplicate-app\",{appName:s})}const a=new i.b(s);for(const t of f.values())a.addComponent(t);const c=new E(t,n,a);return d.set(s,c),c}function I(t=h){const e=d.get(t);if(!e)throw w.create(\"no-app\",{appName:t});return e}function S(t,e,n){var s;let r=null!==(s=l[t])&&void 0!==s?s:t;n&&(r+=`-${n}`);const o=r.match(/\\s|\\//),a=e.match(/\\s|\\//);if(o||a){const t=[`Unable to register library \"${r}\" with version \"${e}\":`];return o&&t.push(`library name \"${r}\" contains illegal characters (whitespace or \"/\")`),o&&a&&t.push(\"and\"),a&&t.push(`version name \"${e}\" contains illegal characters (whitespace or \"/\")`),void u.warn(t.join(\" \"))}g(new i.a(`${r}-version`,()=>({library:r,version:e}),\"VERSION\"))}\n/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst C=\"firebase-heartbeat-database\",_=1,A=\"firebase-heartbeat-store\";let D=null;function N(){return D||(D=Object(r.q)(C,_,(t,e)=>{switch(e){case 0:t.createObjectStore(A)}}).catch(t=>{throw w.create(\"storage-open\",{originalErrorMessage:t.message})})),D}async function k(t,e){try{const n=(await N()).transaction(A,\"readwrite\"),i=n.objectStore(A);return await i.put(e,L(t)),n.complete}catch(t){throw w.create(\"storage-set\",{originalErrorMessage:t.message})}}function L(t){return`${t.name}!${t.options.appId}`}\n/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */const R=1024,O=2592e6;class x{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider(\"app\").getImmediate();this._storage=new V(e),this._heartbeatsCachePromise=this._storage.read().then(t=>(this._heartbeatsCache=t,t))}async triggerHeartbeat(){const t=this.container.getProvider(\"platform-logger\").getImmediate().getPlatformInfoString(),e=M();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some(t=>t.date===e))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=O}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return\"\";const t=M(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=R){const n=[];let i=t.slice();for(const s of t){const t=n.find(t=>t.agent===s.agent);if(t){if(t.dates.push(s.date),P(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),P(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=Object(r.d)(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function M(){return(new Date).toISOString().substring(0,10)}class V{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Object(r.l)()&&Object(r.r)().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){return await async function(t){try{return(await N()).transaction(A).objectStore(A).get(L(t))}catch(t){throw w.create(\"storage-get\",{originalErrorMessage:t.message})}}(this.app)||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return k(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return k(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function P(t){return Object(r.d)(JSON.stringify({version:2,heartbeats:t})).length}\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */!function(t){g(new i.a(\"platform-logger\",t=>new o(t),\"PRIVATE\")),g(new i.a(\"heartbeat\",t=>new x(t),\"PRIVATE\")),S(a,c,t),S(a,c,\"esm2017\"),S(\"fire-js\",\"\")}(\"\")},function(t,e,n){\"use strict\";n.d(e,\"a\",function(){return s}),n.d(e,\"b\",function(){return u}),n.d(e,\"c\",function(){return h}),n.d(e,\"d\",function(){return l});\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst i=[];var s;!function(t){t[t.DEBUG=0]=\"DEBUG\",t[t.VERBOSE=1]=\"VERBOSE\",t[t.INFO=2]=\"INFO\",t[t.WARN=3]=\"WARN\",t[t.ERROR=4]=\"ERROR\",t[t.SILENT=5]=\"SILENT\"}(s||(s={}));const r={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},o=s.INFO,a={[s.DEBUG]:\"log\",[s.VERBOSE]:\"log\",[s.INFO]:\"info\",[s.WARN]:\"warn\",[s.ERROR]:\"error\"},c=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),s=a[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${i}]  ${t.name}:`,...n)};class u{constructor(t){this.name=t,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in s))throw new TypeError(`Invalid value \"${t}\" assigned to \\`logLevel\\``);this._logLevel=t}setLogLevel(t){this._logLevel=\"string\"==typeof t?r[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(\"function\"!=typeof t)throw new TypeError(\"Value assigned to `logHandler` must be a function\");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...t),this._logHandler(this,s.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...t),this._logHandler(this,s.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,s.INFO,...t),this._logHandler(this,s.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,s.WARN,...t),this._logHandler(this,s.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...t),this._logHandler(this,s.ERROR,...t)}}function h(t){i.forEach(e=>{e.setLogLevel(t)})}function l(t,e){for(const n of i){let i=null;e&&e.level&&(i=r[e.level]),n.userLogHandler=null===t?null:(e,n,...r)=>{const o=r.map(t=>{if(null==t)return null;if(\"string\"==typeof t)return t;if(\"number\"==typeof t||\"boolean\"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}}).filter(t=>t).join(\" \");n>=(null!==i&&void 0!==i?i:e.logLevel)&&t({level:s[n].toLowerCase(),message:o,args:r,type:e.name})}}}},function(t,e,n){\"use strict\";n.d(e,\"a\",function(){return s}),n.d(e,\"b\",function(){return a});var i=n(0);class s{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode=\"LAZY\",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */const r=\"[DEFAULT]\";\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class o{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new i.a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null===t||void 0===t?void 0:t.identifier),i=null!==(e=null===t||void 0===t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(i)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return\"EAGER\"===t.instantiationMode}\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */(t))try{this.getOrInitializeService({instanceIdentifier:r})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=r){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(t=>\"INTERNAL\"in t).map(t=>t.INTERNAL.delete()),...t.filter(t=>\"_delete\"in t).map(t=>t._delete())])}isComponentSet(){return null!=this.component}isInitialized(t=r){return this.instances.has(t)}getOptions(t=r){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(t)&&e.resolve(i)}return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&t(r,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:function(t){return t===r?void 0:t}(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}return n||null}normalizeInstanceIdentifier(t=r){return this.component?this.component.multipleInstances?t:r:t}shouldAutoInitialize(){return!!this.component&&\"EXPLICIT\"!==this.component.instantiationMode}}class a{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new o(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}},function(t,e,n){\"use strict\";(function(t){n.d(e,\"a\",function(){return zr}),n.d(e,\"b\",function(){return ar}),n.d(e,\"c\",function(){return Gr}),n.d(e,\"d\",function(){return cr}),n.d(e,\"e\",function(){return Hr}),n.d(e,\"f\",function(){return lr});var i=n(2),s=n(4),r=n(3),o=n(0),a=n(1);const c=\"@firebase/firestore\";\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class u{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?\"uid:\"+this.uid:\"anonymous-user\"}isEqual(t){return t.uid===this.uid}}u.UNAUTHENTICATED=new u(null),u.GOOGLE_CREDENTIALS=new u(\"google-credentials-uid\"),u.FIRST_PARTY=new u(\"first-party-uid\"),u.MOCK_USER=new u(\"mock-user\");\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nlet h=\"9.6.11\";\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */const l=new r.b(\"@firebase/firestore\");function d(){return l.logLevel}function f(t,...e){if(l.logLevel<=r.a.DEBUG){const n=e.map(m);l.debug(`Firestore (${h}): ${t}`,...n)}}function p(t,...e){if(l.logLevel<=r.a.ERROR){const n=e.map(m);l.error(`Firestore (${h}): ${t}`,...n)}}function g(t,...e){if(l.logLevel<=r.a.WARN){const n=e.map(m);l.warn(`Firestore (${h}): ${t}`,...n)}}function m(t){if(\"string\"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */var e}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function y(t=\"Unexpected state\"){const e=`FIRESTORE (${h}) INTERNAL ASSERTION FAILED: `+t;throw p(e),new Error(e)}function v(t,e){t||y()}function w(t,e){return t}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */const E={OK:\"ok\",CANCELLED:\"cancelled\",UNKNOWN:\"unknown\",INVALID_ARGUMENT:\"invalid-argument\",DEADLINE_EXCEEDED:\"deadline-exceeded\",NOT_FOUND:\"not-found\",ALREADY_EXISTS:\"already-exists\",PERMISSION_DENIED:\"permission-denied\",UNAUTHENTICATED:\"unauthenticated\",RESOURCE_EXHAUSTED:\"resource-exhausted\",FAILED_PRECONDITION:\"failed-precondition\",ABORTED:\"aborted\",OUT_OF_RANGE:\"out-of-range\",UNIMPLEMENTED:\"unimplemented\",INTERNAL:\"internal\",UNAVAILABLE:\"unavailable\",DATA_LOSS:\"data-loss\"};class b extends o.c{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class T{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class I{constructor(t,e){this.user=e,this.type=\"OAuth\",this.headers=new Map,this.headers.set(\"Authorization\",`Bearer ${t}`)}}class S{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(u.UNAUTHENTICATED))}shutdown(){}}class C{constructor(t,e,n){this.type=\"FirstParty\",this.user=u.FIRST_PARTY,this.headers=new Map,this.headers.set(\"X-Goog-AuthUser\",e);const i=t.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set(\"Authorization\",i),n&&this.headers.set(\"X-Goog-Iam-Authorization-Token\",n)}}class _{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new C(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable(()=>e(u.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class A{constructor(t){this.value=t,this.type=\"AppCheck\",this.headers=new Map,t&&t.length>0&&this.headers.set(\"x-firebase-appcheck\",this.value)}}\n/**\n * @license\n * Copyright 2018 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass D{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=(t=>this.I(t)),this.T=(t=>e.writeSequenceNumber(t)))}I(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.T&&this.T(t),t}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function N(t){const e=\"undefined\"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&\"function\"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */D.A=-1;class k{static R(){const t=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\",e=Math.floor(256/t.length)*t.length;let n=\"\";for(;n.length<20;){const i=N(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+=t.charAt(i[s]%t.length))}return n}}function L(t,e){return t<e?-1:t>e?1:0}function R(t,e,n){return t.length===e.length&&t.every((t,i)=>n(t,e[i]))}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass O{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new b(E.INVALID_ARGUMENT,\"Timestamp nanoseconds out of range: \"+e);if(e>=1e9)throw new b(E.INVALID_ARGUMENT,\"Timestamp nanoseconds out of range: \"+e);if(t<-62135596800)throw new b(E.INVALID_ARGUMENT,\"Timestamp seconds out of range: \"+t);if(t>=253402300800)throw new b(E.INVALID_ARGUMENT,\"Timestamp seconds out of range: \"+t)}static now(){return O.fromMillis(Date.now())}static fromDate(t){return O.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new O(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?L(this.nanoseconds,t.nanoseconds):L(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return\"Timestamp(seconds=\"+this.seconds+\", nanoseconds=\"+this.nanoseconds+\")\"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,\"0\")+\".\"+String(this.nanoseconds).padStart(9,\"0\")}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class x{constructor(t){this.timestamp=t}static fromTimestamp(t){return new x(t)}static min(){return new x(new O(0,0))}static max(){return new x(new O(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return\"SnapshotVersion(\"+this.timestamp.toString()+\")\"}toTimestamp(){return this.timestamp}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function M(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function V(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function P(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class F{constructor(t,e,n){void 0===e?e=0:e>t.length&&y(),void 0===n?n=t.length-e:n>t.length-e&&y(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===F.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof F?t.forEach(t=>{e.push(t)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.get(i),s=e.get(i);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class U extends F{construct(t,e,n){return new U(t,e,n)}canonicalString(){return this.toArray().join(\"/\")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf(\"//\")>=0)throw new b(E.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split(\"/\").filter(t=>t.length>0))}return new U(e)}static emptyPath(){return new U([])}}const B=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class j extends F{construct(t,e,n){return new j(t,e,n)}static isValidIdentifier(t){return B.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\\\/g,\"\\\\\\\\\").replace(/`/g,\"\\\\`\"),j.isValidIdentifier(t)||(t=\"`\"+t+\"`\"),t)).join(\".\")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&\"__name__\"===this.get(0)}static keyField(){return new j([\"__name__\"])}static fromServerFormat(t){const e=[];let n=\"\",i=0;const s=()=>{if(0===n.length)throw new b(E.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=\"\"};let r=!1;for(;i<t.length;){const e=t[i];if(\"\\\\\"===e){if(i+1===t.length)throw new b(E.INVALID_ARGUMENT,\"Path has trailing escape character: \"+t);const e=t[i+1];if(\"\\\\\"!==e&&\".\"!==e&&\"`\"!==e)throw new b(E.INVALID_ARGUMENT,\"Path has invalid escape sequence: \"+t);n+=e,i+=2}else\"`\"===e?(r=!r,i++):\".\"!==e||r?(n+=e,i++):(s(),i++)}if(s(),r)throw new b(E.INVALID_ARGUMENT,\"Unterminated ` in path: \"+t);return new j(e)}static emptyPath(){return new j([])}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class q{constructor(t){this.fields=t,t.sort(j.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return R(this.fields,t.fields,(t,e)=>t.isEqual(e))}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass ${constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new $(e)}static fromUint8Array(t){const e=function(t){let e=\"\";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new $(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return L(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}$.EMPTY_BYTE_STRING=new $(\"\");const K=new RegExp(/^\\d{4}-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d\\d(?:\\.(\\d+))?Z$/);function H(t){if(v(!!t),\"string\"==typeof t){let e=0;const n=K.exec(t);if(v(!!n),n[1]){let t=n[1];t=(t+\"000000000\").substr(0,9),e=Number(t)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:G(t.seconds),nanos:G(t.nanos)}}function G(t){return\"number\"==typeof t?t:\"string\"==typeof t?Number(t):0}function z(t){return\"string\"==typeof t?$.fromBase64String(t):$.fromUint8Array(t)}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function W(t){var e,n;return\"server_timestamp\"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Q(t){const e=H(t.mapValue.fields.__local_write_time__.timestampValue);return new O(e.seconds,e.nanos)}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class X{constructor(t,e,n,i,s,r,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Y{constructor(t,e){this.projectId=t,this.database=e||\"(default)\"}static empty(){return new Y(\"\",\"\")}get isDefaultDatabase(){return\"(default)\"===this.database}isEqual(t){return t instanceof Y&&t.projectId===this.projectId&&t.database===this.database}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function J(t){return null==t}function Z(t){return 0===t&&1/t==-1/0}function tt(t){return\"number\"==typeof t&&Number.isInteger(t)&&!Z(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class et{constructor(t){this.path=t}static fromPath(t){return new et(U.fromString(t))}static fromName(t){return new et(U.fromString(t).popFirst(5))}static empty(){return new et(U.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===U.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return U.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new et(new U(t.slice()))}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function nt(t){return\"nullValue\"in t?0:\"booleanValue\"in t?1:\"integerValue\"in t||\"doubleValue\"in t?2:\"timestampValue\"in t?3:\"stringValue\"in t?5:\"bytesValue\"in t?6:\"referenceValue\"in t?7:\"geoPointValue\"in t?8:\"arrayValue\"in t?9:\"mapValue\"in t?W(t)?4:pt(t)?9:10:y()}function it(t,e){if(t===e)return!0;const n=nt(t);if(n!==nt(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Q(t).isEqual(Q(e));case 3:return function(t,e){if(\"string\"==typeof t.timestampValue&&\"string\"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=H(t.timestampValue),i=H(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return z(t.bytesValue).isEqual(z(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return G(t.geoPointValue.latitude)===G(e.geoPointValue.latitude)&&G(t.geoPointValue.longitude)===G(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if(\"integerValue\"in t&&\"integerValue\"in e)return G(t.integerValue)===G(e.integerValue);if(\"doubleValue\"in t&&\"doubleValue\"in e){const n=G(t.doubleValue),i=G(e.doubleValue);return n===i?Z(n)===Z(i):isNaN(n)&&isNaN(i)}return!1}(t,e);case 9:return R(t.arrayValue.values||[],e.arrayValue.values||[],it);case 10:return function(t,e){const n=t.mapValue.fields||{},i=e.mapValue.fields||{};if(M(n)!==M(i))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===i[t]||!it(n[t],i[t])))return!1;return!0}(t,e);default:return y()}}function st(t,e){return void 0!==(t.values||[]).find(t=>it(t,e))}function rt(t,e){if(t===e)return 0;const n=nt(t),i=nt(e);if(n!==i)return L(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return L(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=G(t.integerValue||t.doubleValue),i=G(e.integerValue||e.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(t,e);case 3:return ot(t.timestampValue,e.timestampValue);case 4:return ot(Q(t),Q(e));case 5:return L(t.stringValue,e.stringValue);case 6:return function(t,e){const n=z(t),i=z(e);return n.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split(\"/\"),i=e.split(\"/\");for(let t=0;t<n.length&&t<i.length;t++){const e=L(n[t],i[t]);if(0!==e)return e}return L(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=L(G(t.latitude),G(e.latitude));return 0!==n?n:L(G(t.longitude),G(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],i=e.values||[];for(let t=0;t<n.length&&t<i.length;++t){const e=rt(n[t],i[t]);if(e)return e}return L(n.length,i.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},i=Object.keys(n),s=e.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let t=0;t<i.length&&t<r.length;++t){const e=L(i[t],r[t]);if(0!==e)return e;const o=rt(n[i[t]],s[r[t]]);if(0!==o)return o}return L(i.length,r.length)}(t.mapValue,e.mapValue);default:throw y()}}function ot(t,e){if(\"string\"==typeof t&&\"string\"==typeof e&&t.length===e.length)return L(t,e);const n=H(t),i=H(e),s=L(n.seconds,i.seconds);return 0!==s?s:L(n.nanos,i.nanos)}function at(t){return function t(e){return\"nullValue\"in e?\"null\":\"booleanValue\"in e?\"\"+e.booleanValue:\"integerValue\"in e?\"\"+e.integerValue:\"doubleValue\"in e?\"\"+e.doubleValue:\"timestampValue\"in e?function(t){const e=H(t);return`time(${e.seconds},${e.nanos})`}(e.timestampValue):\"stringValue\"in e?e.stringValue:\"bytesValue\"in e?z(e.bytesValue).toBase64():\"referenceValue\"in e?(i=e.referenceValue,et.fromName(i).toString()):\"geoPointValue\"in e?`geo(${(n=e.geoPointValue).latitude},${n.longitude})`:\"arrayValue\"in e?function(e){let n=\"[\",i=!0;for(const s of e.values||[])i?i=!1:n+=\",\",n+=t(s);return n+\"]\"}(e.arrayValue):\"mapValue\"in e?function(e){const n=Object.keys(e.fields||{}).sort();let i=\"{\",s=!0;for(const r of n)s?s=!1:i+=\",\",i+=`${r}:${t(e.fields[r])}`;return i+\"}\"}(e.mapValue):y();var n,i}(t)}function ct(t){return!!t&&\"integerValue\"in t}function ut(t){return!!t&&\"arrayValue\"in t}function ht(t){return!!t&&\"nullValue\"in t}function lt(t){return!!t&&\"doubleValue\"in t&&isNaN(Number(t.doubleValue))}function dt(t){return!!t&&\"mapValue\"in t}function ft(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&\"object\"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return V(t.mapValue.fields,(t,n)=>e.mapValue.fields[t]=ft(n)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=ft(t.arrayValue.values[n]);return e}return Object.assign({},t)}function pt(t){return\"__max__\"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass gt{constructor(t){this.value=t}static empty(){return new gt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(!dt(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ft(e)}setAll(t){let e=j.emptyPath(),n={},i=[];t.forEach((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,i),n={},i=[],e=s.popLast()}t?n[s.lastSegment()]=ft(t):i.push(s.lastSegment())});const s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){const e=this.field(t.popLast());dt(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return it(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];dt(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){V(e,(e,n)=>t[e]=n);for(const e of n)delete t[e]}clone(){return new gt(ft(this.value))}}function mt(t){const e=[];return V(t.fields,(t,n)=>{const i=new j([t]);if(dt(n)){const t=mt(n.mapValue).fields;if(0===t.length)e.push(i);else for(const n of t)e.push(i.child(n))}else e.push(i)}),new q(e)\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */}class yt{constructor(t,e,n,i,s,r){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.data=s,this.documentState=r}static newInvalidDocument(t){return new yt(t,0,x.min(),x.min(),gt.empty(),0)}static newFoundDocument(t,e,n){return new yt(t,1,e,x.min(),n,0)}static newNoDocument(t,e){return new yt(t,2,e,x.min(),gt.empty(),0)}static newUnknownDocument(t,e){return new yt(t,3,e,x.min(),gt.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=gt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=gt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof yt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new yt(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class vt{constructor(t,e,n,i){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=i}}vt.UNKNOWN_ID=-1;function wt(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,s=x.fromTimestamp(1e9===i?new O(n+1,0):new O(n,i));return new bt(s,et.empty(),e)}function Et(t){return new bt(t.readTime,t.key,-1)}class bt{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new bt(x.min(),et.empty(),-1)}static max(){return new bt(x.max(),et.empty(),-1)}}function Tt(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:0!==(n=et.comparator(t.documentKey,e.documentKey))?n:L(t.largestBatchId,e.largestBatchId)}\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class It{constructor(t,e=null,n=[],i=[],s=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=o,this.P=null}}function St(t,e=null,n=[],i=[],s=null,r=null,o=null){return new It(t,e,n,i,s,r,o)}function Ct(t){const e=w(t);if(null===e.P){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+=\"|cg:\"+e.collectionGroup),t+=\"|f:\",t+=e.filters.map(t=>{return(e=t).field.canonicalString()+e.op.toString()+at(e.value);var e}).join(\",\"),t+=\"|ob:\",t+=e.orderBy.map(t=>(function(t){return t.field.canonicalString()+t.dir})(t)).join(\",\"),J(e.limit)||(t+=\"|l:\",t+=e.limit),e.startAt&&(t+=\"|lb:\",t+=e.startAt.inclusive?\"b:\":\"a:\",t+=e.startAt.position.map(t=>at(t)).join(\",\")),e.endAt&&(t+=\"|ub:\",t+=e.endAt.inclusive?\"a:\":\"b:\",t+=e.endAt.position.map(t=>at(t)).join(\",\")),e.P=t}return e.P}function _t(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Ut(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(n=t.filters[s],i=e.filters[s],n.op!==i.op||!n.field.isEqual(i.field)||!it(n.value,i.value))return!1;var n,i;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!jt(t.startAt,e.startAt)&&jt(t.endAt,e.endAt)}function At(t){return et.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Dt extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?\"in\"===e||\"not-in\"===e?this.V(t,e,n):new Nt(t,e,n):\"array-contains\"===e?new Ot(t,n):\"in\"===e?new xt(t,n):\"not-in\"===e?new Mt(t,n):\"array-contains-any\"===e?new Vt(t,n):new Dt(t,e,n)}static V(t,e,n){return\"in\"===e?new kt(t,n):new Lt(t,n)}matches(t){const e=t.data.field(this.field);return\"!=\"===this.op?null!==e&&this.v(rt(e,this.value)):null!==e&&nt(this.value)===nt(e)&&this.v(rt(e,this.value))}v(t){switch(this.op){case\"<\":return t<0;case\"<=\":return t<=0;case\"==\":return 0===t;case\"!=\":return 0!==t;case\">\":return t>0;case\">=\":return t>=0;default:return y()}}S(){return[\"<\",\"<=\",\">\",\">=\",\"!=\",\"not-in\"].indexOf(this.op)>=0}}class Nt extends Dt{constructor(t,e,n){super(t,e,n),this.key=et.fromName(n.referenceValue)}matches(t){const e=et.comparator(t.key,this.key);return this.v(e)}}class kt extends Dt{constructor(t,e){super(t,\"in\",e),this.keys=Rt(\"in\",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Lt extends Dt{constructor(t,e){super(t,\"not-in\",e),this.keys=Rt(\"not-in\",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Rt(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>et.fromName(t.referenceValue))}class Ot extends Dt{constructor(t,e){super(t,\"array-contains\",e)}matches(t){const e=t.data.field(this.field);return ut(e)&&st(e.arrayValue,this.value)}}class xt extends Dt{constructor(t,e){super(t,\"in\",e)}matches(t){const e=t.data.field(this.field);return null!==e&&st(this.value.arrayValue,e)}}class Mt extends Dt{constructor(t,e){super(t,\"not-in\",e)}matches(t){if(st(this.value.arrayValue,{nullValue:\"NULL_VALUE\"}))return!1;const e=t.data.field(this.field);return null!==e&&!st(this.value.arrayValue,e)}}class Vt extends Dt{constructor(t,e){super(t,\"array-contains-any\",e)}matches(t){const e=t.data.field(this.field);return!(!ut(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>st(this.value.arrayValue,t))}}class Pt{constructor(t,e){this.position=t,this.inclusive=e}}class Ft{constructor(t,e=\"asc\"){this.field=t,this.dir=e}}function Ut(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Bt(t,e,n){let i=0;for(let s=0;s<t.position.length;s++){const r=e[s],o=t.position[s];if(i=r.field.isKeyField()?et.comparator(et.fromName(o.referenceValue),n.key):rt(o,n.data.field(r.field)),\"desc\"===r.dir&&(i*=-1),0!==i)break}return i}function jt(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!it(t.position[n],e.position[n]))return!1;return!0}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class qt{constructor(t,e=null,n=[],i=[],s=null,r=\"F\",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=o,this.endAt=a,this.D=null,this.C=null,this.startAt,this.endAt}}function $t(t,e,n,i,s,r,o,a){return new qt(t,e,n,i,s,r,o,a)}function Kt(t){return new qt(t)}function Ht(t){return!J(t.limit)&&\"F\"===t.limitType}function Gt(t){return!J(t.limit)&&\"L\"===t.limitType}function zt(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Wt(t){for(const e of t.filters)if(e.S())return e.field;return null}function Qt(t){return null!==t.collectionGroup}function Xt(t){const e=w(t);if(null===e.D){e.D=[];const t=Wt(e),n=zt(e);if(null!==t&&null===n)t.isKeyField()||e.D.push(new Ft(t)),e.D.push(new Ft(j.keyField(),\"asc\"));else{let t=!1;for(const n of e.explicitOrderBy)e.D.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:\"asc\";e.D.push(new Ft(j.keyField(),t))}}}return e.D}function Yt(t){const e=w(t);if(!e.C)if(\"F\"===e.limitType)e.C=St(e.path,e.collectionGroup,Xt(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Xt(e)){const e=\"desc\"===n.dir?\"asc\":\"desc\";t.push(new Ft(n.field,e))}const n=e.endAt?new Pt(e.endAt.position,!e.endAt.inclusive):null,i=e.startAt?new Pt(e.startAt.position,!e.startAt.inclusive):null;e.C=St(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}return e.C}function Jt(t,e,n){return new qt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Zt(t,e){return _t(Yt(t),Yt(e))&&t.limitType===e.limitType}function te(t){return`${Ct(Yt(t))}|lt:${t.limitType}`}function ee(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=\" collectionGroup=\"+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>{return`${(e=t).field.canonicalString()} ${e.op} ${at(e.value)}`;var e}).join(\", \")}]`),J(t.limit)||(e+=\", limit: \"+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>(function(t){return`${t.field.canonicalString()} (${t.dir})`})(t)).join(\", \")}]`),t.startAt&&(e+=\", startAt: \",e+=t.startAt.inclusive?\"b:\":\"a:\",e+=t.startAt.position.map(t=>at(t)).join(\",\")),t.endAt&&(e+=\", endAt: \",e+=t.endAt.inclusive?\"a:\":\"b:\",e+=t.endAt.position.map(t=>at(t)).join(\",\")),`Target(${e})`}(Yt(t))}; limitType=${t.limitType})`}function ne(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):et.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const i=Bt(t,e,n);return t.inclusive?i<=0:i<0}(t.startAt,Xt(t),e))&&!(t.endAt&&!function(t,e,n){const i=Bt(t,e,n);return t.inclusive?i>=0:i>0}(t.endAt,Xt(t),e))}(t,e)}function ie(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function se(t){return(e,n)=>{let i=!1;for(const s of Xt(t)){const t=re(s,e,n);if(0!==t)return t;i=i||s.field.isKeyField()}return 0}}function re(t,e,n){const i=t.field.isKeyField()?et.comparator(e.key,n.key):function(t,e,n){const i=e.data.field(t),s=n.data.field(t);return null!==i&&null!==s?rt(i,s):y()}\n/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */(t.field,e,n);switch(t.dir){case\"asc\":return i;case\"desc\":return-1*i;default:return y()}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function oe(t,e){if(t.N){if(isNaN(e))return{doubleValue:\"NaN\"};if(e===1/0)return{doubleValue:\"Infinity\"};if(e===-1/0)return{doubleValue:\"-Infinity\"}}return{doubleValue:Z(e)?\"-0\":e}}function ae(t){return{integerValue:\"\"+t}}function ce(t,e){return tt(e)?ae(e):oe(t,e)}\n/**\n * @license\n * Copyright 2018 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class ue{constructor(){this._=void 0}}function he(t,e,n){return t instanceof fe?function(t,e){const n={fields:{__type__:{stringValue:\"server_timestamp\"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof pe?ge(t,e):t instanceof me?ye(t,e):function(t,e){const n=de(t,e),i=we(n)+we(t.k);return ct(n)&&ct(t.k)?ae(i):oe(t.M,i)}(t,e)}function le(t,e,n){return t instanceof pe?ge(t,e):t instanceof me?ye(t,e):n}function de(t,e){return t instanceof ve?ct(n=e)||n&&\"doubleValue\"in n?e:{integerValue:0}:null;var n}class fe extends ue{}class pe extends ue{constructor(t){super(),this.elements=t}}function ge(t,e){const n=Ee(e);for(const e of t.elements)n.some(t=>it(t,e))||n.push(e);return{arrayValue:{values:n}}}class me extends ue{constructor(t){super(),this.elements=t}}function ye(t,e){let n=Ee(e);for(const e of t.elements)n=n.filter(t=>!it(t,e));return{arrayValue:{values:n}}}class ve extends ue{constructor(t,e){super(),this.M=t,this.k=e}}function we(t){return G(t.integerValue||t.doubleValue)}function Ee(t){return ut(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class be{constructor(t,e){this.version=t,this.transformResults=e}}class Te{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Te}static exists(t){return new Te(void 0,t)}static updateTime(t){return new Te(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ie(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Se{}function Ce(t,e,n){t instanceof ke?function(t,e,n){const i=t.value.clone(),s=Oe(t.fieldTransforms,e,n.transformResults);i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):t instanceof Le?function(t,e,n){if(!Ie(t.precondition,e))return void e.convertToUnknownDocument(n.version);const i=Oe(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Re(t)),s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function _e(t,e,n){t instanceof ke?function(t,e,n){if(!Ie(t.precondition,e))return;const i=t.value.clone(),s=xe(t.fieldTransforms,n,e);i.setAll(s),e.convertToFoundDocument(Ne(e),i).setHasLocalMutations()}(t,e,n):t instanceof Le?function(t,e,n){if(!Ie(t.precondition,e))return;const i=xe(t.fieldTransforms,n,e),s=e.data;s.setAll(Re(t)),s.setAll(i),e.convertToFoundDocument(Ne(e),s).setHasLocalMutations()}(t,e,n):function(t,e){Ie(t.precondition,e)&&e.convertToNoDocument(x.min())}(t,e)}function Ae(t,e){let n=null;for(const i of t.fieldTransforms){const t=e.data.field(i.field),s=de(i.transform,t||null);null!=s&&(null==n&&(n=gt.empty()),n.set(i.field,s))}return n||null}function De(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&R(t,e,(t,e)=>(function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof pe&&e instanceof pe||t instanceof me&&e instanceof me?R(t.elements,e.elements,it):t instanceof ve&&e instanceof ve?it(t.k,e.k):t instanceof fe&&e instanceof fe}(t.transform,e.transform)})(t,e))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Ne(t){return t.isFoundDocument()?t.version:x.min()}class ke extends Se{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}}class Le extends Se{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}}function Re(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}}),e}function Oe(t,e,n){const i=new Map;v(t.length===n.length);for(let s=0;s<n.length;s++){const r=t[s],o=r.transform,a=e.data.field(r.field);i.set(r.field,le(o,a,n[s]))}return i}function xe(t,e,n){const i=new Map;for(const s of t){const t=s.transform,r=n.data.field(s.field);i.set(s.field,he(t,r,e))}return i}class Me extends Se{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class Ve extends Se{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Pe{constructor(t){this.count=t}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */var Fe,Ue;function Be(t){switch(t){default:return y();case E.CANCELLED:case E.UNKNOWN:case E.DEADLINE_EXCEEDED:case E.RESOURCE_EXHAUSTED:case E.INTERNAL:case E.UNAVAILABLE:case E.UNAUTHENTICATED:return!1;case E.INVALID_ARGUMENT:case E.NOT_FOUND:case E.ALREADY_EXISTS:case E.PERMISSION_DENIED:case E.FAILED_PRECONDITION:case E.ABORTED:case E.OUT_OF_RANGE:case E.UNIMPLEMENTED:case E.DATA_LOSS:return!0}}function je(t){if(void 0===t)return p(\"GRPC error has no .code\"),E.UNKNOWN;switch(t){case Fe.OK:return E.OK;case Fe.CANCELLED:return E.CANCELLED;case Fe.UNKNOWN:return E.UNKNOWN;case Fe.DEADLINE_EXCEEDED:return E.DEADLINE_EXCEEDED;case Fe.RESOURCE_EXHAUSTED:return E.RESOURCE_EXHAUSTED;case Fe.INTERNAL:return E.INTERNAL;case Fe.UNAVAILABLE:return E.UNAVAILABLE;case Fe.UNAUTHENTICATED:return E.UNAUTHENTICATED;case Fe.INVALID_ARGUMENT:return E.INVALID_ARGUMENT;case Fe.NOT_FOUND:return E.NOT_FOUND;case Fe.ALREADY_EXISTS:return E.ALREADY_EXISTS;case Fe.PERMISSION_DENIED:return E.PERMISSION_DENIED;case Fe.FAILED_PRECONDITION:return E.FAILED_PRECONDITION;case Fe.ABORTED:return E.ABORTED;case Fe.OUT_OF_RANGE:return E.OUT_OF_RANGE;case Fe.UNIMPLEMENTED:return E.UNIMPLEMENTED;case Fe.DATA_LOSS:return E.DATA_LOSS;default:return y()}}(Ue=Fe||(Fe={}))[Ue.OK=0]=\"OK\",Ue[Ue.CANCELLED=1]=\"CANCELLED\",Ue[Ue.UNKNOWN=2]=\"UNKNOWN\",Ue[Ue.INVALID_ARGUMENT=3]=\"INVALID_ARGUMENT\",Ue[Ue.DEADLINE_EXCEEDED=4]=\"DEADLINE_EXCEEDED\",Ue[Ue.NOT_FOUND=5]=\"NOT_FOUND\",Ue[Ue.ALREADY_EXISTS=6]=\"ALREADY_EXISTS\",Ue[Ue.PERMISSION_DENIED=7]=\"PERMISSION_DENIED\",Ue[Ue.UNAUTHENTICATED=16]=\"UNAUTHENTICATED\",Ue[Ue.RESOURCE_EXHAUSTED=8]=\"RESOURCE_EXHAUSTED\",Ue[Ue.FAILED_PRECONDITION=9]=\"FAILED_PRECONDITION\",Ue[Ue.ABORTED=10]=\"ABORTED\",Ue[Ue.OUT_OF_RANGE=11]=\"OUT_OF_RANGE\",Ue[Ue.UNIMPLEMENTED=12]=\"UNIMPLEMENTED\",Ue[Ue.INTERNAL=13]=\"INTERNAL\",Ue[Ue.UNAVAILABLE=14]=\"UNAVAILABLE\",Ue[Ue.DATA_LOSS=15]=\"DATA_LOSS\";\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass qe{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,i]of n)if(this.equalsFn(e,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0===i)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return void(i[n]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){V(this.inner,(e,n)=>{for(const[e,i]of n)t(e,i)})}isEmpty(){return P(this.inner)}size(){return this.innerSize}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class $e{constructor(t,e){this.comparator=t,this.root=e||He.EMPTY}insert(t,e){return new $e(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,He.BLACK,null,null))}remove(t){return new $e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,He.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(\", \")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ke(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ke(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ke(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ke(this.root,t,this.comparator,!0)}}class Ke{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class He{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=null!=n?n:He.RED,this.left=null!=i?i:He.EMPTY,this.right=null!=s?s:He.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new He(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const s=n(t,i.key);return(i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp()}removeMin(){if(this.left.isEmpty())return He.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return He.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t}rotateLeft(){const t=this.copy(null,null,He.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,He.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw y();if(this.right.isRed())throw y();const t=this.left.check();if(t!==this.right.check())throw y();return t+(this.isRed()?0:1)}}He.EMPTY=null,He.RED=!0,He.BLACK=!1,He.EMPTY=new class{constructor(){this.size=0}get key(){throw y()}get value(){throw y()}get color(){throw y()}get left(){throw y()}get right(){throw y()}copy(t,e,n,i,s){return this}insert(t,e,n){return new He(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass Ge{constructor(t){this.comparator=t,this.data=new $e(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new ze(this.data.getIterator())}getIteratorFrom(t){return new ze(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof Ge))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),\"SortedSet(\"+t.toString()+\")\"}copy(t){const e=new Ge(this.comparator);return e.data=t,e}}class ze{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst We=new $e(et.comparator);function Qe(){return We}const Xe=new $e(et.comparator);function Ye(){return Xe}function Je(){return new qe(t=>t.toString(),(t,e)=>t.isEqual(e))}const Ze=new $e(et.comparator),tn=new Ge(et.comparator);function en(...t){let e=tn;for(const n of t)e=e.add(n);return e}const nn=new Ge(L);function sn(){return nn}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class rn{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,on.createSynthesizedTargetChangeForCurrentChange(t,e)),new rn(x.min(),n,sn(),Qe(),en())}}class on{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e){return new on($.EMPTY_BYTE_STRING,e,en(),en(),en())}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class an{constructor(t,e,n,i){this.O=t,this.removedTargetIds=e,this.key=n,this.F=i}}class cn{constructor(t,e){this.targetId=t,this.$=e}}class un{constructor(t,e,n=$.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}}class hn{constructor(){this.B=0,this.L=fn(),this.U=$.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return 0!==this.B}get j(){return this.K}W(t){t.approximateByteSize()>0&&(this.K=!0,this.U=t)}H(){let t=en(),e=en(),n=en();return this.L.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:y()}}),new on(this.U,this.q,t,e,n)}J(){this.K=!1,this.L=fn()}Y(t,e){this.K=!0,this.L=this.L.insert(t,e)}X(t){this.K=!0,this.L=this.L.remove(t)}Z(){this.B+=1}tt(){this.B-=1}et(){this.K=!0,this.q=!0}}class ln{constructor(t){this.nt=t,this.st=new Map,this.it=Qe(),this.rt=dn(),this.ot=new Ge(L)}ut(t){for(const e of t.O)t.F&&t.F.isFoundDocument()?this.at(e,t.F):this.ct(e,t.key,t.F);for(const e of t.removedTargetIds)this.ct(e,t.key,t.F)}ht(t){this.forEachTarget(t,e=>{const n=this.lt(e);switch(t.state){case 0:this.ft(e)&&n.W(t.resumeToken);break;case 1:n.tt(),n.G||n.J(),n.W(t.resumeToken);break;case 2:n.tt(),n.G||this.removeTarget(e);break;case 3:this.ft(e)&&(n.et(),n.W(t.resumeToken));break;case 4:this.ft(e)&&(this.dt(e),n.W(t.resumeToken));break;default:y()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.st.forEach((t,n)=>{this.ft(n)&&e(n)})}_t(t){const e=t.targetId,n=t.$.count,i=this.wt(e);if(i){const t=i.target;if(At(t))if(0===n){const n=new et(t.path);this.ct(e,n,yt.newNoDocument(n,x.min()))}else v(1===n);else this.gt(e)!==n&&(this.dt(e),this.ot=this.ot.add(e))}}yt(t){const e=new Map;this.st.forEach((n,i)=>{const s=this.wt(i);if(s){if(n.current&&At(s.target)){const e=new et(s.target.path);null!==this.it.get(e)||this.It(i,e)||this.ct(i,e,yt.newNoDocument(e,t))}n.j&&(e.set(i,n.H()),n.J())}});let n=en();this.rt.forEach((t,e)=>{let i=!0;e.forEachWhile(t=>{const e=this.wt(t);return!e||2===e.purpose||(i=!1,!1)}),i&&(n=n.add(t))}),this.it.forEach((e,n)=>n.setReadTime(t));const i=new rn(t,e,this.ot,this.it,n);return this.it=Qe(),this.rt=dn(),this.ot=new Ge(L),i}at(t,e){if(!this.ft(t))return;const n=this.It(t,e.key)?2:0;this.lt(t).Y(e.key,n),this.it=this.it.insert(e.key,e),this.rt=this.rt.insert(e.key,this.Tt(e.key).add(t))}ct(t,e,n){if(!this.ft(t))return;const i=this.lt(t);this.It(t,e)?i.Y(e,1):i.X(e),this.rt=this.rt.insert(e,this.Tt(e).delete(t)),n&&(this.it=this.it.insert(e,n))}removeTarget(t){this.st.delete(t)}gt(t){const e=this.lt(t).H();return this.nt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Z(t){this.lt(t).Z()}lt(t){let e=this.st.get(t);return e||(e=new hn,this.st.set(t,e)),e}Tt(t){let e=this.rt.get(t);return e||(e=new Ge(L),this.rt=this.rt.insert(t,e)),e}ft(t){const e=null!==this.wt(t);return e||f(\"WatchChangeAggregator\",\"Detected inactive target\",t),e}wt(t){const e=this.st.get(t);return e&&e.G?null:this.nt.Et(t)}dt(t){this.st.set(t,new hn),this.nt.getRemoteKeysForTarget(t).forEach(e=>{this.ct(t,e,null)})}It(t,e){return this.nt.getRemoteKeysForTarget(t).has(e)}}function dn(){return new $e(et.comparator)}function fn(){return new $e(et.comparator)}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */const pn={asc:\"ASCENDING\",desc:\"DESCENDING\"},gn={\"<\":\"LESS_THAN\",\"<=\":\"LESS_THAN_OR_EQUAL\",\">\":\"GREATER_THAN\",\">=\":\"GREATER_THAN_OR_EQUAL\",\"==\":\"EQUAL\",\"!=\":\"NOT_EQUAL\",\"array-contains\":\"ARRAY_CONTAINS\",in:\"IN\",\"not-in\":\"NOT_IN\",\"array-contains-any\":\"ARRAY_CONTAINS_ANY\"};class mn{constructor(t,e){this.databaseId=t,this.N=e}}function yn(t,e){return t.N?`${new Date(1e3*e.seconds).toISOString().replace(/\\.\\d*/,\"\").replace(\"Z\",\"\")}.${(\"000000000\"+e.nanoseconds).slice(-9)}Z`:{seconds:\"\"+e.seconds,nanos:e.nanoseconds}}function vn(t,e){return t.N?e.toBase64():e.toUint8Array()}function wn(t){return v(!!t),x.fromTimestamp(function(t){const e=H(t);return new O(e.seconds,e.nanos)}(t))}function En(t,e){return function(t){return new U([\"projects\",t.projectId,\"databases\",t.database])}(t).child(\"documents\").child(e).canonicalString()}function bn(t){const e=U.fromString(t);return v(Mn(e)),e}function Tn(t,e){return En(t.databaseId,e.path)}function In(t,e){const n=bn(e);if(n.get(1)!==t.databaseId.projectId)throw new b(E.INVALID_ARGUMENT,\"Tried to deserialize key from different project: \"+n.get(1)+\" vs \"+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new b(E.INVALID_ARGUMENT,\"Tried to deserialize key from different database: \"+n.get(3)+\" vs \"+t.databaseId.database);return new et(An(n))}function Sn(t,e){return En(t.databaseId,e)}function Cn(t){const e=bn(t);return 4===e.length?U.emptyPath():An(e)}function _n(t){return new U([\"projects\",t.databaseId.projectId,\"databases\",t.databaseId.database]).canonicalString()}function An(t){return v(t.length>4&&\"documents\"===t.get(4)),t.popFirst(5)}function Dn(t,e,n){return{name:Tn(t,e),fields:n.value.mapValue.fields}}function Nn(t,e){let n;if(e instanceof ke)n={update:Dn(t,e.key,e.value)};else if(e instanceof Me)n={delete:Tn(t,e.key)};else if(e instanceof Le)n={update:Dn(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}(e.fieldMask)};else{if(!(e instanceof Ve))return y();n={verify:Tn(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof fe)return{fieldPath:e.field.canonicalString(),setToServerValue:\"REQUEST_TIME\"};if(n instanceof pe)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof me)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ve)return{fieldPath:e.field.canonicalString(),increment:n.k};throw y()})(0,t))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return yn(t,e.toTimestamp())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:y()}(t,e.precondition)),n}function kn(t,e){return{documents:[Sn(t,e.path)]}}function Ln(t,e){const n={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(n.parent=Sn(t,i),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Sn(t,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const s=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if(\"==\"===t.op){if(lt(t.value))return{unaryFilter:{field:On(t.field),op:\"IS_NAN\"}};if(ht(t.value))return{unaryFilter:{field:On(t.field),op:\"IS_NULL\"}}}else if(\"!=\"===t.op){if(lt(t.value))return{unaryFilter:{field:On(t.field),op:\"IS_NOT_NAN\"}};if(ht(t.value))return{unaryFilter:{field:On(t.field),op:\"IS_NOT_NULL\"}}}return{fieldFilter:{field:On(t.field),op:function(t){return gn[t]}(t.op),value:t.value}}})(t));return 1===e.length?e[0]:{compositeFilter:{op:\"AND\",filters:e}}}(e.filters);s&&(n.structuredQuery.where=s);const r=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:On(t.field),direction:function(t){return pn[t]}(t.dir)}})(t))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.N||J(e)?e:{value:e}}(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function Rn(t){let e=Cn(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){v(1===i);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case\"IS_NAN\":const e=xn(t.unaryFilter.field);return Dt.create(e,\"==\",{doubleValue:NaN});case\"IS_NULL\":const n=xn(t.unaryFilter.field);return Dt.create(n,\"==\",{nullValue:\"NULL_VALUE\"});case\"IS_NOT_NAN\":const i=xn(t.unaryFilter.field);return Dt.create(i,\"!=\",{doubleValue:NaN});case\"IS_NOT_NULL\":const s=xn(t.unaryFilter.field);return Dt.create(s,\"!=\",{nullValue:\"NULL_VALUE\"});default:return y()}}(e)]:void 0!==e.fieldFilter?[function(t){return Dt.create(xn(t.fieldFilter.field),function(t){switch(t){case\"EQUAL\":return\"==\";case\"NOT_EQUAL\":return\"!=\";case\"GREATER_THAN\":return\">\";case\"GREATER_THAN_OR_EQUAL\":return\">=\";case\"LESS_THAN\":return\"<\";case\"LESS_THAN_OR_EQUAL\":return\"<=\";case\"ARRAY_CONTAINS\":return\"array-contains\";case\"IN\":return\"in\";case\"NOT_IN\":return\"not-in\";case\"ARRAY_CONTAINS_ANY\":return\"array-contains-any\";default:return y()}}(t.fieldFilter.op),t.fieldFilter.value)}(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((t,e)=>t.concat(e)):y():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(t=>(function(t){return new Ft(xn(t.field),function(t){switch(t){case\"ASCENDING\":return\"asc\";case\"DESCENDING\":return\"desc\";default:return}}(t.direction))})(t)));let a=null;n.limit&&(a=function(t){let e;return J(e=\"object\"==typeof t?t.value:t)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new Pt(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new Pt(n,e)}(n.endAt)),$t(e,s,o,r,a,\"F\",c,u)}function On(t){return{fieldPath:t.canonicalString()}}function xn(t){return j.fromServerFormat(t.fieldPath)}function Mn(t){return t.length>=4&&\"projects\"===t.get(0)&&\"databases\"===t.get(2)}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */const Vn=[...[...[...[...[\"mutationQueues\",\"mutations\",\"documentMutations\",\"remoteDocuments\",\"targets\",\"owner\",\"targetGlobal\",\"targetDocuments\"],\"clientMetadata\"],\"remoteDocumentGlobal\"],\"collectionParents\"],\"bundles\",\"namedQueries\"],Pn=[\"mutationQueues\",\"mutations\",\"documentMutations\",\"remoteDocumentsV14\",\"targets\",\"owner\",\"targetGlobal\",\"targetDocuments\",\"clientMetadata\",\"remoteDocumentGlobal\",\"collectionParents\",\"bundles\",\"namedQueries\",\"documentOverlays\"],Fn=\"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.\";\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Un{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Bn{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&y(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Bn((n,i)=>{this.nextCallback=(e=>{this.wrapSuccess(t,e).next(n,i)}),this.catchCallback=(t=>{this.wrapFailure(e,t).next(n,i)})})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof Bn?e:Bn.resolve(e)}catch(t){return Bn.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):Bn.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):Bn.reject(e)}static resolve(t){return new Bn((e,n)=>{e(t)})}static reject(t){return new Bn((e,n)=>{n(t)})}static waitFor(t){return new Bn((e,n)=>{let i=0,s=0,r=!1;t.forEach(t=>{++i,t.next(()=>{++s,r&&s===i&&e()},t=>n(t))}),r=!0,s===i&&e()})}static or(t){let e=Bn.resolve(!1);for(const n of t)e=e.next(t=>t?Bn.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,i)=>{n.push(e.call(this,t,i))}),this.waitFor(n)}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function jn(t){return\"IndexedDbTransactionError\"===t.name}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass qn{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const i=this.mutations[e];i.key.isEqual(t.key)&&Ce(i,t,n[e])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&_e(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&_e(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach(e=>{const n=t.get(e.key),i=n;this.applyToLocalView(i),n.isValidDocument()||i.convertToNoDocument(x.min())})}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),en())}isEqual(t){return this.batchId===t.batchId&&R(this.mutations,t.mutations,(t,e)=>De(t,e))&&R(this.baseMutations,t.baseMutations,(t,e)=>De(t,e))}}class $n{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){v(t.mutations.length===n.length);let i=Ze;const s=t.mutations;for(let t=0;t<s.length;t++)i=i.insert(s[t].key,n[t].version);return new $n(t,e,n,i)}}\n/**\n * @license\n * Copyright 2022 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Kn{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\\n      largestBatchId: ${this.largestBatchId},\\n      mutation: ${this.mutation.toString()}\\n    }`}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Hn{constructor(t,e,n,i,s=x.min(),r=x.min(),o=$.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}withSequenceNumber(t){return new Hn(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new Hn(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new Hn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Gn{constructor(t){this.Jt=t}}function zn(t){const e=Rn({parent:t.parent,structuredQuery:t.structuredQuery});return\"LAST\"===t.limitType?Jt(e,e.limit,\"L\"):e}\n/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass Wn{constructor(){}Zt(t,e){this.te(t,e),e.ee()}te(t,e){if(\"nullValue\"in t)this.ne(e,5);else if(\"booleanValue\"in t)this.ne(e,10),e.se(t.booleanValue?1:0);else if(\"integerValue\"in t)this.ne(e,15),e.se(G(t.integerValue));else if(\"doubleValue\"in t){const n=G(t.doubleValue);isNaN(n)?this.ne(e,13):(this.ne(e,15),Z(n)?e.se(0):e.se(n))}else if(\"timestampValue\"in t){const n=t.timestampValue;this.ne(e,20),\"string\"==typeof n?e.ie(n):(e.ie(`${n.seconds||\"\"}`),e.se(n.nanos||0))}else if(\"stringValue\"in t)this.re(t.stringValue,e),this.oe(e);else if(\"bytesValue\"in t)this.ne(e,30),e.ue(z(t.bytesValue)),this.oe(e);else if(\"referenceValue\"in t)this.ae(t.referenceValue,e);else if(\"geoPointValue\"in t){const n=t.geoPointValue;this.ne(e,45),e.se(n.latitude||0),e.se(n.longitude||0)}else\"mapValue\"in t?pt(t)?this.ne(e,Number.MAX_SAFE_INTEGER):(this.ce(t.mapValue,e),this.oe(e)):\"arrayValue\"in t?(this.he(t.arrayValue,e),this.oe(e)):y()}re(t,e){this.ne(e,25),this.le(t,e)}le(t,e){e.ie(t)}ce(t,e){const n=t.fields||{};this.ne(e,55);for(const t of Object.keys(n))this.re(t,e),this.te(n[t],e)}he(t,e){const n=t.values||[];this.ne(e,50);for(const t of n)this.te(t,e)}ae(t,e){this.ne(e,37),et.fromName(t).path.forEach(t=>{this.ne(e,60),this.le(t,e)})}ne(t,e){t.se(e)}oe(t){t.se(2)}}Wn.fe=new Wn;\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass Qn{constructor(){this.qe=new Xn}addToCollectionParentIndex(t,e){return this.qe.add(e),Bn.resolve()}getCollectionParents(t,e){return Bn.resolve(this.qe.getEntries(e))}addFieldIndex(t,e){return Bn.resolve()}deleteFieldIndex(t,e){return Bn.resolve()}getDocumentsMatchingTarget(t,e){return Bn.resolve(null)}getFieldIndex(t,e){return Bn.resolve(null)}getFieldIndexes(t,e){return Bn.resolve([])}getNextCollectionGroupToUpdate(t){return Bn.resolve(null)}updateCollectionGroup(t,e,n){return Bn.resolve()}updateIndexEntries(t,e){return Bn.resolve()}}class Xn{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new Ge(U.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new Ge(U.comparator)).toArray()}}\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */new Uint8Array(0);class Yn{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Yn(t,Yn.DEFAULT_COLLECTION_PERCENTILE,Yn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */Yn.DEFAULT_COLLECTION_PERCENTILE=10,Yn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Yn.DEFAULT=new Yn(41943040,Yn.DEFAULT_COLLECTION_PERCENTILE,Yn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Yn.DISABLED=new Yn(-1,0,0);\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass Jn{constructor(t){this.mn=t}next(){return this.mn+=2,this.mn}static gn(){return new Jn(0)}static yn(){return new Jn(-1)}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nasync function Zn(t){if(t.code!==E.FAILED_PRECONDITION||t.message!==Fn)throw t;f(\"LocalStore\",\"Unexpectedly lost primary lease\")}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass ti{constructor(){this.changes=new qe(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,yt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Bn.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass ei{constructor(t,e,n){this.ds=t,this.Bs=e,this.indexManager=n}Ls(t,e){return this.Bs.getAllMutationBatchesAffectingDocumentKey(t,e).next(n=>this.Us(t,e,n))}Us(t,e,n){return this.ds.getEntry(t,e).next(t=>{for(const e of n)e.applyToLocalView(t);return t})}qs(t,e){t.forEach((t,n)=>{for(const t of e)t.applyToLocalView(n)})}Ks(t,e){return this.ds.getEntries(t,e).next(e=>this.Gs(t,e).next(()=>e))}Gs(t,e){return this.Bs.getAllMutationBatchesAffectingDocumentKeys(t,e).next(t=>this.qs(e,t))}Qs(t,e,n){return function(t){return et.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.js(t,e.path):Qt(e)?this.Ws(t,e,n):this.zs(t,e,n)}js(t,e){return this.Ls(t,new et(e)).next(t=>{let e=Ye();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})}Ws(t,e,n){const i=e.collectionGroup;let s=Ye();return this.indexManager.getCollectionParents(t,i).next(r=>Bn.forEach(r,r=>{const o=function(t,e){return new qt(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(i));return this.zs(t,o,n).next(t=>{t.forEach((t,e)=>{s=s.insert(t,e)})})}).next(()=>s))}zs(t,e,n){let i;return this.ds.getAllFromCollection(t,e.path,n).next(n=>(i=n,this.Bs.getAllMutationBatchesAffectingQuery(t,e))).next(t=>{for(const e of t)for(const t of e.mutations){const n=t.key;let s=i.get(n);null==s&&(s=yt.newInvalidDocument(n),i=i.insert(n,s)),_e(t,s,e.localWriteTime),s.isFoundDocument()||(i=i.remove(n))}}).next(()=>(i.forEach((t,n)=>{ne(e,n)||(i=i.remove(t))}),i))}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class ni{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Hs=n,this.Js=i}static Ys(t,e){let n=en(),i=en();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:i=i.add(t.doc.key)}return new ni(t,e.fromCache,n,i)}}\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class ii{Xs(t){this.Zs=t}Qs(t,e,n,i){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(x.min())?this.ti(t,e):this.Zs.Ks(t,i).next(s=>{const o=this.ei(e,s);return(Ht(e)||Gt(e))&&this.ni(e.limitType,o,i,n)?this.ti(t,e):(d()<=r.a.DEBUG&&f(\"QueryEngine\",\"Re-using previous result from %s to execute query: %s\",n.toString(),ee(e)),this.Zs.Qs(t,e,wt(n,-1)).next(t=>(o.forEach(e=>{t=t.insert(e.key,e)}),t)))})}ei(t,e){let n=new Ge(se(t));return e.forEach((e,i)=>{ne(t,i)&&(n=n.add(i))}),n}ni(t,e,n,i){if(n.size!==e.size)return!0;const s=\"F\"===t?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ti(t,e){return d()<=r.a.DEBUG&&f(\"QueryEngine\",\"Using full collection scan to execute query:\",ee(e)),this.Zs.Qs(t,e,bt.min())}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class si{constructor(t,e,n,i){this.persistence=t,this.si=e,this.M=i,this.ii=new $e(L),this.ri=new qe(t=>Ct(t),_t),this.oi=new Map,this.ui=t.getRemoteDocumentCache(),this.fs=t.getTargetCache(),this._s=t.getBundleCache(),this.ai(n)}ai(t){this.indexManager=this.persistence.getIndexManager(t),this.Bs=this.persistence.getMutationQueue(t,this.indexManager),this.ci=new ei(this.ui,this.Bs,this.indexManager),this.ui.setIndexManager(this.indexManager),this.si.Xs(this.ci)}collectGarbage(t){return this.persistence.runTransaction(\"Collect garbage\",\"readwrite-primary\",e=>t.collect(e,this.ii))}}function ri(t,e,n,i){return new si(t,e,n,i)}async function oi(t,e){const n=w(t);return await n.persistence.runTransaction(\"Handle user change\",\"readonly\",t=>{let i;return n.Bs.getAllMutationBatches(t).next(s=>(i=s,n.ai(e),n.Bs.getAllMutationBatches(t))).next(e=>{const s=[],r=[];let o=en();for(const t of i){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.ci.Ks(t,o).next(t=>({hi:t,removedBatchIds:s,addedBatchIds:r}))})})}function ai(t){const e=w(t);return e.persistence.runTransaction(\"Get last remote snapshot version\",\"readonly\",t=>e.fs.getLastRemoteSnapshotVersion(t))}function ci(t,e,n){let i=en();return n.forEach(t=>i=i.add(t)),e.getEntries(t,i).next(t=>{let i=Qe();return n.forEach((n,s)=>{const r=t.get(n);s.isNoDocument()&&s.version.isEqual(x.min())?(e.removeEntry(n,s.readTime),i=i.insert(n,s)):!r.isValidDocument()||s.version.compareTo(r.version)>0||0===s.version.compareTo(r.version)&&r.hasPendingWrites?(e.addEntry(s),i=i.insert(n,s)):f(\"LocalStore\",\"Ignoring outdated watch update for \",n,\". Current version:\",r.version,\" Watch version:\",s.version)}),i})}function ui(t,e){const n=w(t);return n.persistence.runTransaction(\"Get next mutation batch\",\"readonly\",t=>(void 0===e&&(e=-1),n.Bs.getNextMutationBatchAfterBatchId(t,e)))}function hi(t,e){const n=w(t);return n.persistence.runTransaction(\"Allocate target\",\"readwrite\",t=>{let i;return n.fs.getTargetData(t,e).next(s=>s?(i=s,Bn.resolve(i)):n.fs.allocateTargetId(t).next(s=>(i=new Hn(e,s,0,t.currentSequenceNumber),n.fs.addTargetData(t,i).next(()=>i))))}).then(t=>{const i=n.ii.get(t.targetId);return(null===i||t.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.ii=n.ii.insert(t.targetId,t),n.ri.set(e,t.targetId)),t})}async function li(t,e,n){const i=w(t),s=i.ii.get(e),r=n?\"readwrite\":\"readwrite-primary\";try{n||await i.persistence.runTransaction(\"Release target\",r,t=>i.persistence.referenceDelegate.removeTarget(t,s))}catch(t){if(!jn(t))throw t;f(\"LocalStore\",`Failed to update sequence numbers for target ${e}: ${t}`)}i.ii=i.ii.remove(e),i.ri.delete(s.target)}function di(t,e,n){const i=w(t);let s=x.min(),r=en();return i.persistence.runTransaction(\"Execute query\",\"readonly\",t=>(function(t,e,n){const i=w(t),s=i.ri.get(n);return void 0!==s?Bn.resolve(i.ii.get(s)):i.fs.getTargetData(e,n)})(i,t,Yt(e)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.fs.getMatchingKeysForTargetId(t,e.targetId).next(t=>{r=t})}).next(()=>i.si.Qs(t,e,n?s:x.min(),n?r:en())).next(t=>(fi(i,ie(e),t),{documents:t,li:r})))}function fi(t,e,n){let i=x.min();n.forEach((t,e)=>{e.readTime.compareTo(i)>0&&(i=e.readTime)}),t.oi.set(e,i)}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass pi{constructor(t){this.M=t,this.wi=new Map,this.mi=new Map}getBundleMetadata(t,e){return Bn.resolve(this.wi.get(e))}saveBundleMetadata(t,e){var n;return this.wi.set(e.id,{id:(n=e).id,version:n.version,createTime:wn(n.createTime)}),Bn.resolve()}getNamedQuery(t,e){return Bn.resolve(this.mi.get(e))}saveNamedQuery(t,e){return this.mi.set(e.name,function(t){return{name:t.name,query:zn(t.bundledQuery),readTime:wn(t.readTime)}}(e)),Bn.resolve()}}\n/**\n * @license\n * Copyright 2022 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class gi{constructor(){this.overlays=new $e(et.comparator),this.gi=new Map}getOverlay(t,e){return Bn.resolve(this.overlays.get(e))}saveOverlays(t,e,n){return n.forEach((n,i)=>{this.Xt(t,e,i)}),Bn.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.gi.get(n);return void 0!==i&&(i.forEach(t=>this.overlays=this.overlays.remove(t)),this.gi.delete(n)),Bn.resolve()}getOverlaysForCollection(t,e,n){const i=Je(),s=e.length+1,r=new et(e.child(\"\")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===s&&t.largestBatchId>n&&i.set(t.getKey(),t)}return Bn.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new $e((t,e)=>t-e);const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=Je(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Je(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((t,e)=>o.set(t,e)),!(o.size()>=i)););return Bn.resolve(o)}Xt(t,e,n){if(null===n)return;const i=this.overlays.get(n.key);if(null!==i){const t=this.gi.get(i.largestBatchId).delete(n.key);this.gi.set(i.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Kn(e,n));let s=this.gi.get(e);void 0===s&&(s=en(),this.gi.set(e,s)),this.gi.set(e,s.add(n.key))}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class mi{constructor(){this.yi=new Ge(yi.pi),this.Ii=new Ge(yi.Ti)}isEmpty(){return this.yi.isEmpty()}addReference(t,e){const n=new yi(t,e);this.yi=this.yi.add(n),this.Ii=this.Ii.add(n)}Ei(t,e){t.forEach(t=>this.addReference(t,e))}removeReference(t,e){this.Ai(new yi(t,e))}Ri(t,e){t.forEach(t=>this.removeReference(t,e))}Pi(t){const e=new et(new U([])),n=new yi(e,t),i=new yi(e,t+1),s=[];return this.Ii.forEachInRange([n,i],t=>{this.Ai(t),s.push(t.key)}),s}bi(){this.yi.forEach(t=>this.Ai(t))}Ai(t){this.yi=this.yi.delete(t),this.Ii=this.Ii.delete(t)}Vi(t){const e=new et(new U([])),n=new yi(e,t),i=new yi(e,t+1);let s=en();return this.Ii.forEachInRange([n,i],t=>{s=s.add(t.key)}),s}containsKey(t){const e=new yi(t,0),n=this.yi.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class yi{constructor(t,e){this.key=t,this.vi=e}static pi(t,e){return et.comparator(t.key,e.key)||L(t.vi,e.vi)}static Ti(t,e){return L(t.vi,e.vi)||et.comparator(t.key,e.key)}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class vi{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.Bs=[],this.Si=1,this.Di=new Ge(yi.pi)}checkEmpty(t){return Bn.resolve(0===this.Bs.length)}addMutationBatch(t,e,n,i){const s=this.Si;this.Si++,this.Bs.length>0&&this.Bs[this.Bs.length-1];const r=new qn(s,e,n,i);this.Bs.push(r);for(const e of i)this.Di=this.Di.add(new yi(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Bn.resolve(r)}lookupMutationBatch(t,e){return Bn.resolve(this.Ci(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.xi(n),s=i<0?0:i;return Bn.resolve(this.Bs.length>s?this.Bs[s]:null)}getHighestUnacknowledgedBatchId(){return Bn.resolve(0===this.Bs.length?-1:this.Si-1)}getAllMutationBatches(t){return Bn.resolve(this.Bs.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new yi(e,0),i=new yi(e,Number.POSITIVE_INFINITY),s=[];return this.Di.forEachInRange([n,i],t=>{const e=this.Ci(t.vi);s.push(e)}),Bn.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ge(L);return e.forEach(t=>{const e=new yi(t,0),i=new yi(t,Number.POSITIVE_INFINITY);this.Di.forEachInRange([e,i],t=>{n=n.add(t.vi)})}),Bn.resolve(this.Ni(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let s=n;et.isDocumentKey(s)||(s=s.child(\"\"));const r=new yi(new et(s),0);let o=new Ge(L);return this.Di.forEachWhile(t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===i&&(o=o.add(t.vi)),!0)},r),Bn.resolve(this.Ni(o))}Ni(t){const e=[];return t.forEach(t=>{const n=this.Ci(t);null!==n&&e.push(n)}),e}removeMutationBatch(t,e){v(0===this.ki(e.batchId,\"removed\")),this.Bs.shift();let n=this.Di;return Bn.forEach(e.mutations,i=>{const s=new yi(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.Di=n})}_n(t){}containsKey(t,e){const n=new yi(e,0),i=this.Di.firstAfterOrEqual(n);return Bn.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.Bs.length,Bn.resolve()}ki(t,e){return this.xi(t)}xi(t){return 0===this.Bs.length?0:t-this.Bs[0].batchId}Ci(t){const e=this.xi(t);return e<0||e>=this.Bs.length?null:this.Bs[e]}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class wi{constructor(t){this.Mi=t,this.docs=new $e(et.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),s=i?i.size:0,r=this.Mi(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Bn.resolve(n?n.document.mutableCopy():yt.newInvalidDocument(e))}getEntries(t,e){let n=Qe();return e.forEach(t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():yt.newInvalidDocument(t))}),Bn.resolve(n)}getAllFromCollection(t,e,n){let i=Qe();const s=new et(e.child(\"\")),r=this.docs.getIteratorFrom(s);for(;r.hasNext();){const{key:t,value:{document:s}}=r.getNext();if(!e.isPrefixOf(t.path))break;t.path.length>e.length+1||Tt(Et(s),n)<=0||(i=i.insert(s.key,s.mutableCopy()))}return Bn.resolve(i)}getAllFromCollectionGroup(t,e,n,i){y()}Oi(t,e){return Bn.forEach(this.docs,t=>e(t))}newChangeBuffer(t){return new Ei(this)}getSize(t){return Bn.resolve(this.size)}}class Ei extends ti{constructor(t){super(),this.Kn=t}applyChanges(t){const e=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?e.push(this.Kn.addEntry(t,i)):this.Kn.removeEntry(n)}),Bn.waitFor(e)}getFromCache(t,e){return this.Kn.getEntry(t,e)}getAllFromCache(t,e){return this.Kn.getEntries(t,e)}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class bi{constructor(t){this.persistence=t,this.Fi=new qe(t=>Ct(t),_t),this.lastRemoteSnapshotVersion=x.min(),this.highestTargetId=0,this.$i=0,this.Bi=new mi,this.targetCount=0,this.Li=Jn.gn()}forEachTarget(t,e){return this.Fi.forEach((t,n)=>e(n)),Bn.resolve()}getLastRemoteSnapshotVersion(t){return Bn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Bn.resolve(this.$i)}allocateTargetId(t){return this.highestTargetId=this.Li.next(),Bn.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.$i&&(this.$i=e),Bn.resolve()}Tn(t){this.Fi.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Li=new Jn(e),this.highestTargetId=e),t.sequenceNumber>this.$i&&(this.$i=t.sequenceNumber)}addTargetData(t,e){return this.Tn(e),this.targetCount+=1,Bn.resolve()}updateTargetData(t,e){return this.Tn(e),Bn.resolve()}removeTargetData(t,e){return this.Fi.delete(e.target),this.Bi.Pi(e.targetId),this.targetCount-=1,Bn.resolve()}removeTargets(t,e,n){let i=0;const s=[];return this.Fi.forEach((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Fi.delete(r),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),i++)}),Bn.waitFor(s).next(()=>i)}getTargetCount(t){return Bn.resolve(this.targetCount)}getTargetData(t,e){const n=this.Fi.get(e)||null;return Bn.resolve(n)}addMatchingKeys(t,e,n){return this.Bi.Ei(e,n),Bn.resolve()}removeMatchingKeys(t,e,n){this.Bi.Ri(e,n);const i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(e=>{s.push(i.markPotentiallyOrphaned(t,e))}),Bn.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Bi.Pi(e),Bn.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Bi.Vi(e);return Bn.resolve(n)}containsKey(t,e){return Bn.resolve(this.Bi.containsKey(e))}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Ti{constructor(t,e){this.Ui={},this.overlays={},this.es=new D(0),this.ns=!1,this.ns=!0,this.referenceDelegate=t(this),this.fs=new bi(this),this.indexManager=new Qn,this.ds=function(t){return new wi(t)}(t=>this.referenceDelegate.qi(t)),this.M=new Gn(e),this._s=new pi(this.M)}start(){return Promise.resolve()}shutdown(){return this.ns=!1,Promise.resolve()}get started(){return this.ns}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new gi,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Ui[t.toKey()];return n||(n=new vi(e,this.referenceDelegate),this.Ui[t.toKey()]=n),n}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getBundleCache(){return this._s}runTransaction(t,e,n){f(\"MemoryPersistence\",\"Starting transaction:\",t);const i=new Ii(this.es.next());return this.referenceDelegate.Ki(),n(i).next(t=>this.referenceDelegate.Gi(i).next(()=>t)).toPromise().then(t=>(i.raiseOnCommittedEvent(),t))}Qi(t,e){return Bn.or(Object.values(this.Ui).map(n=>()=>n.containsKey(t,e)))}}class Ii extends Un{constructor(t){super(),this.currentSequenceNumber=t}}class Si{constructor(t){this.persistence=t,this.ji=new mi,this.Wi=null}static zi(t){return new Si(t)}get Hi(){if(this.Wi)return this.Wi;throw y()}addReference(t,e,n){return this.ji.addReference(n,e),this.Hi.delete(n.toString()),Bn.resolve()}removeReference(t,e,n){return this.ji.removeReference(n,e),this.Hi.add(n.toString()),Bn.resolve()}markPotentiallyOrphaned(t,e){return this.Hi.add(e.toString()),Bn.resolve()}removeTarget(t,e){this.ji.Pi(e.targetId).forEach(t=>this.Hi.add(t.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(t=>{t.forEach(t=>this.Hi.add(t.toString()))}).next(()=>n.removeTargetData(t,e))}Ki(){this.Wi=new Set}Gi(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Bn.forEach(this.Hi,n=>{const i=et.fromPath(n);return this.Ji(t,i).next(t=>{t||e.removeEntry(i,x.min())})}).next(()=>(this.Wi=null,e.apply(t)))}updateLimboDocument(t,e){return this.Ji(t,e).next(t=>{t?this.Hi.delete(e.toString()):this.Hi.add(e.toString())})}qi(t){return 0}Ji(t,e){return Bn.or([()=>Bn.resolve(this.ji.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Qi(t,e)])}}\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Ci{constructor(){this.activeTargetIds=sn()}Zi(t){this.activeTargetIds=this.activeTargetIds.add(t)}tr(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Xi(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class _i{constructor(){this.$r=new Ci,this.Br={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.$r.Zi(t),this.Br[t]||\"not-current\"}updateQueryState(t,e,n){this.Br[t]=e}removeLocalQueryTarget(t){this.$r.tr(t)}isLocalQueryTarget(t){return this.$r.activeTargetIds.has(t)}clearQueryState(t){delete this.Br[t]}getAllActiveQueryTargets(){return this.$r.activeTargetIds}isActiveQueryTarget(t){return this.$r.activeTargetIds.has(t)}start(){return this.$r=new Ci,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Ai{Lr(t){}shutdown(){}}\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Di{constructor(){this.Ur=(()=>this.qr()),this.Kr=(()=>this.Gr()),this.Qr=[],this.jr()}Lr(t){this.Qr.push(t)}shutdown(){window.removeEventListener(\"online\",this.Ur),window.removeEventListener(\"offline\",this.Kr)}jr(){window.addEventListener(\"online\",this.Ur),window.addEventListener(\"offline\",this.Kr)}qr(){f(\"ConnectivityMonitor\",\"Network connectivity changed: AVAILABLE\");for(const t of this.Qr)t(0)}Gr(){f(\"ConnectivityMonitor\",\"Network connectivity changed: UNAVAILABLE\");for(const t of this.Qr)t(1)}static vt(){return\"undefined\"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */const Ni={BatchGetDocuments:\"batchGet\",Commit:\"commit\",RunQuery:\"runQuery\"};\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class ki{constructor(t){this.Wr=t.Wr,this.zr=t.zr}Hr(t){this.Jr=t}Yr(t){this.Xr=t}onMessage(t){this.Zr=t}close(){this.zr()}send(t){this.Wr(t)}eo(){this.Jr()}no(t){this.Xr(t)}so(t){this.Zr(t)}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Li extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?\"https\":\"http\";this.io=e+\"://\"+t.host,this.ro=\"projects/\"+this.databaseId.projectId+\"/databases/\"+this.databaseId.database+\"/documents\"}oo(t,e,n,i,s){const r=this.uo(t,e);f(\"RestConnection\",\"Sending: \",r,n);const o={};return this.ao(o,i,s),this.co(t,r,o,n).then(t=>(f(\"RestConnection\",\"Received: \",t),t),e=>{throw g(\"RestConnection\",`${t} failed with error: `,e,\"url: \",r,\"request:\",n),e})}ho(t,e,n,i,s){return this.oo(t,e,n,i,s)}ao(t,e,n){t[\"X-Goog-Api-Client\"]=\"gl-js/ fire/\"+h,t[\"Content-Type\"]=\"text/plain\",this.databaseInfo.appId&&(t[\"X-Firebase-GMPID\"]=this.databaseInfo.appId),e&&e.headers.forEach((e,n)=>t[n]=e),n&&n.headers.forEach((e,n)=>t[n]=e)}uo(t,e){const n=Ni[t];return`${this.io}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}co(t,e,n,i){return new Promise((s,r)=>{const o=new a.g;o.listenOnce(a.c.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case a.a.NO_ERROR:const e=o.getResponseJson();f(\"Connection\",\"XHR received:\",JSON.stringify(e)),s(e);break;case a.a.TIMEOUT:f(\"Connection\",'RPC \"'+t+'\" timed out'),r(new b(E.DEADLINE_EXCEEDED,\"Request time out\"));break;case a.a.HTTP_ERROR:const n=o.getStatus();if(f(\"Connection\",'RPC \"'+t+'\" failed with status:',n,\"response text:\",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,\"-\");return Object.values(E).indexOf(e)>=0?e:E.UNKNOWN}(t.status);r(new b(e,t.message))}else r(new b(E.UNKNOWN,\"Server responded with status \"+o.getStatus()))}else r(new b(E.UNAVAILABLE,\"Connection failed.\"));break;default:y()}}finally{f(\"Connection\",'RPC \"'+t+'\" completed.')}});const c=JSON.stringify(i);o.send(e,\"POST\",c,n,15)})}lo(t,e,n){const i=[this.io,\"/\",\"google.firestore.v1.Firestore\",\"/\",t,\"/channel\"],s=Object(a.h)(),r=Object(a.i)(),c={httpSessionIdParam:\"gsessionid\",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(c.xmlHttpFactory=new a.d({})),this.ao(c.initMessageHeaders,e,n),Object(o.m)()||Object(o.n)()||Object(o.j)()||Object(o.k)()||Object(o.p)()||Object(o.i)()||(c.httpHeadersOverwriteParam=\"$httpHeaders\");const u=i.join(\"\");f(\"Connection\",\"Creating WebChannel: \"+u,c);const h=s.createWebChannel(u,c);let l=!1,d=!1;const p=new ki({Wr:t=>{d?f(\"Connection\",\"Not sending because WebChannel is closed:\",t):(l||(f(\"Connection\",\"Opening WebChannel transport.\"),h.open(),l=!0),f(\"Connection\",\"WebChannel sending:\",t),h.send(t))},zr:()=>h.close()}),m=(t,e,n)=>{t.listen(e,t=>{try{n(t)}catch(t){setTimeout(()=>{throw t},0)}})};return m(h,a.f.EventType.OPEN,()=>{d||f(\"Connection\",\"WebChannel transport opened.\")}),m(h,a.f.EventType.CLOSE,()=>{d||(d=!0,f(\"Connection\",\"WebChannel transport closed\"),p.no())}),m(h,a.f.EventType.ERROR,t=>{d||(d=!0,g(\"Connection\",\"WebChannel transport errored:\",t),p.no(new b(E.UNAVAILABLE,\"The operation could not be completed\")))}),m(h,a.f.EventType.MESSAGE,t=>{var e;if(!d){const n=t.data[0];v(!!n);const i=n,s=i.error||(null===(e=i[0])||void 0===e?void 0:e.error);if(s){f(\"Connection\",\"WebChannel received error:\",s);const t=s.status;let e=function(t){const e=Fe[t];if(void 0!==e)return je(e)}(t),n=s.message;void 0===e&&(e=E.INTERNAL,n=\"Unknown error status: \"+t+\" with message \"+s.message),d=!0,p.no(new b(e,n)),h.close()}else f(\"Connection\",\"WebChannel received:\",n),p.so(n)}}),m(r,a.b.STAT_EVENT,t=>{t.stat===a.e.PROXY?f(\"Connection\",\"Detected buffering proxy\"):t.stat===a.e.NOPROXY&&f(\"Connection\",\"Detected no buffering proxy\")}),setTimeout(()=>{p.eo()},0),p}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function Ri(){return\"undefined\"!=typeof document?document:null}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function Oi(t){return new mn(t,!0)}class xi{constructor(t,e,n=1e3,i=1.5,s=6e4){this.Yn=t,this.timerId=e,this.fo=n,this._o=i,this.wo=s,this.mo=0,this.yo=null,this.po=Date.now(),this.reset()}reset(){this.mo=0}Io(){this.mo=this.wo}To(t){this.cancel();const e=Math.floor(this.mo+this.Eo()),n=Math.max(0,Date.now()-this.po),i=Math.max(0,e-n);i>0&&f(\"ExponentialBackoff\",`Backing off for ${i} ms (base delay: ${this.mo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.yo=this.Yn.enqueueAfterDelay(this.timerId,i,()=>(this.po=Date.now(),t())),this.mo*=this._o,this.mo<this.fo&&(this.mo=this.fo),this.mo>this.wo&&(this.mo=this.wo)}Ao(){null!==this.yo&&(this.yo.skipDelay(),this.yo=null)}cancel(){null!==this.yo&&(this.yo.cancel(),this.yo=null)}Eo(){return(Math.random()-.5)*this.mo}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Mi{constructor(t,e,n,i,s,r,o,a){this.Yn=t,this.Ro=n,this.Po=i,this.bo=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Vo=0,this.vo=null,this.So=null,this.stream=null,this.Do=new xi(t,e)}Co(){return 1===this.state||5===this.state||this.xo()}xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.No()}async stop(){this.Co()&&await this.close(0)}ko(){this.state=0,this.Do.reset()}Mo(){this.xo()&&null===this.vo&&(this.vo=this.Yn.enqueueAfterDelay(this.Ro,6e4,()=>this.Oo()))}Fo(t){this.$o(),this.stream.send(t)}async Oo(){if(this.xo())return this.close(0)}$o(){this.vo&&(this.vo.cancel(),this.vo=null)}Bo(){this.So&&(this.So.cancel(),this.So=null)}async close(t,e){this.$o(),this.Bo(),this.Do.cancel(),this.Vo++,4!==t?this.Do.reset():e&&e.code===E.RESOURCE_EXHAUSTED?(p(e.toString()),p(\"Using maximum backoff delay to prevent overloading the backend.\"),this.Do.Io()):e&&e.code===E.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Lo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Yr(e)}Lo(){}auth(){this.state=1;const t=this.Uo(this.Vo),e=this.Vo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([t,n])=>{this.Vo===e&&this.qo(t,n)},e=>{t(()=>{const t=new b(E.UNKNOWN,\"Fetching auth token failed: \"+e.message);return this.Ko(t)})})}qo(t,e){const n=this.Uo(this.Vo);this.stream=this.Go(t,e),this.stream.Hr(()=>{n(()=>(this.state=2,this.So=this.Yn.enqueueAfterDelay(this.Po,1e4,()=>(this.xo()&&(this.state=3),Promise.resolve())),this.listener.Hr()))}),this.stream.Yr(t=>{n(()=>this.Ko(t))}),this.stream.onMessage(t=>{n(()=>this.onMessage(t))})}No(){this.state=5,this.Do.To(async()=>{this.state=0,this.start()})}Ko(t){return f(\"PersistentStream\",`close with error: ${t}`),this.stream=null,this.close(4,t)}Uo(t){return e=>{this.Yn.enqueueAndForget(()=>this.Vo===t?e():(f(\"PersistentStream\",\"stream callback skipped by getCloseGuardedDispatcher.\"),Promise.resolve()))}}}class Vi extends Mi{constructor(t,e,n,i,s,r){super(t,\"listen_stream_connection_backoff\",\"listen_stream_idle\",\"health_check_timeout\",e,n,i,r),this.M=s}Go(t,e){return this.bo.lo(\"Listen\",t,e)}onMessage(t){this.Do.reset();const e=function(t,e){let n;if(\"targetChange\"in e){e.targetChange;const i=function(t){return\"NO_CHANGE\"===t?0:\"ADD\"===t?1:\"REMOVE\"===t?2:\"CURRENT\"===t?3:\"RESET\"===t?4:y()}(e.targetChange.targetChangeType||\"NO_CHANGE\"),s=e.targetChange.targetIds||[],r=function(t,e){return t.N?(v(void 0===e||\"string\"==typeof e),$.fromBase64String(e||\"\")):(v(void 0===e||e instanceof Uint8Array),$.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?E.UNKNOWN:je(t.code);return new b(e,t.message||\"\")}(o);n=new un(i,s,r,a||null)}else if(\"documentChange\"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const s=In(t,i.document.name),r=wn(i.document.updateTime),o=new gt({mapValue:{fields:i.document.fields}}),a=yt.newFoundDocument(s,r,o),c=i.targetIds||[],u=i.removedTargetIds||[];n=new an(c,u,a.key,a)}else if(\"documentDelete\"in e){e.documentDelete;const i=e.documentDelete;i.document;const s=In(t,i.document),r=i.readTime?wn(i.readTime):x.min(),o=yt.newNoDocument(s,r),a=i.removedTargetIds||[];n=new an([],a,o.key,o)}else if(\"documentRemove\"in e){e.documentRemove;const i=e.documentRemove;i.document;const s=In(t,i.document),r=i.removedTargetIds||[];n=new an([],r,s,null)}else{if(!(\"filter\"in e))return y();{e.filter;const t=e.filter;t.targetId;const i=t.count||0,s=new Pe(i),r=t.targetId;n=new cn(r,s)}}return n}(this.M,t),n=function(t){if(!(\"targetChange\"in t))return x.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?x.min():e.readTime?wn(e.readTime):x.min()}(t);return this.listener.Qo(e,n)}jo(t){const e={};e.database=_n(this.M),e.addTarget=function(t,e){let n;const i=e.target;return(n=At(i)?{documents:kn(t,i)}:{query:Ln(t,i)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=vn(t,e.resumeToken):e.snapshotVersion.compareTo(x.min())>0&&(n.readTime=yn(t,e.snapshotVersion.toTimestamp())),n}(this.M,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return\"existence-filter-mismatch\";case 2:return\"limbo-document\";default:return y()}}(0,e.purpose);return null==n?null:{\"goog-listen-tags\":n}}(this.M,t);n&&(e.labels=n),this.Fo(e)}Wo(t){const e={};e.database=_n(this.M),e.removeTarget=t,this.Fo(e)}}class Pi extends Mi{constructor(t,e,n,i,s,r){super(t,\"write_stream_connection_backoff\",\"write_stream_idle\",\"health_check_timeout\",e,n,i,r),this.M=s,this.zo=!1}get Ho(){return this.zo}start(){this.zo=!1,this.lastStreamToken=void 0,super.start()}Lo(){this.zo&&this.Jo([])}Go(t,e){return this.bo.lo(\"Write\",t,e)}onMessage(t){if(v(!!t.streamToken),this.lastStreamToken=t.streamToken,this.zo){this.Do.reset();const e=function(t,e){return t&&t.length>0?(v(void 0!==e),t.map(t=>(function(t,e){let n=t.updateTime?wn(t.updateTime):wn(e);return n.isEqual(x.min())&&(n=wn(e)),new be(n,t.transformResults||[])})(t,e))):[]}(t.writeResults,t.commitTime),n=wn(t.commitTime);return this.listener.Yo(n,e)}return v(!t.writeResults||0===t.writeResults.length),this.zo=!0,this.listener.Xo()}Zo(){const t={};t.database=_n(this.M),this.Fo(t)}Jo(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>Nn(this.M,t))};this.Fo(e)}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Fi extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.bo=n,this.M=i,this.tu=!1}eu(){if(this.tu)throw new b(E.FAILED_PRECONDITION,\"The client has already been terminated.\")}oo(t,e,n){return this.eu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.bo.oo(t,e,n,i,s)).catch(t=>{throw\"FirebaseError\"===t.name?(t.code===E.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new b(E.UNKNOWN,t.toString())})}ho(t,e,n){return this.eu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.bo.ho(t,e,n,i,s)).catch(t=>{throw\"FirebaseError\"===t.name?(t.code===E.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new b(E.UNKNOWN,t.toString())})}terminate(){this.tu=!0}}class Ui{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=\"Unknown\",this.nu=0,this.su=null,this.iu=!0}ru(){0===this.nu&&(this.ou(\"Unknown\"),this.su=this.asyncQueue.enqueueAfterDelay(\"online_state_timeout\",1e4,()=>(this.su=null,this.uu(\"Backend didn't respond within 10 seconds.\"),this.ou(\"Offline\"),Promise.resolve())))}au(t){\"Online\"===this.state?this.ou(\"Unknown\"):(this.nu++,this.nu>=1&&(this.cu(),this.uu(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ou(\"Offline\")))}set(t){this.cu(),this.nu=0,\"Online\"===t&&(this.iu=!1),this.ou(t)}ou(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}uu(t){const e=`Could not reach Cloud Firestore backend. ${t}\\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.iu?(p(e),this.iu=!1):f(\"OnlineStateTracker\",e)}cu(){null!==this.su&&(this.su.cancel(),this.su=null)}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Bi{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.hu=[],this.lu=new Map,this.fu=new Set,this.du=[],this._u=s,this._u.Lr(t=>{n.enqueueAndForget(async()=>{Qi(this)&&(f(\"RemoteStore\",\"Restarting streams for network reachability change.\"),await async function(t){const e=w(t);e.fu.add(4),await qi(e),e.wu.set(\"Unknown\"),e.fu.delete(4),await ji(e)}(this))})}),this.wu=new Ui(n,i)}}async function ji(t){if(Qi(t))for(const e of t.du)await e(!0)}async function qi(t){for(const e of t.du)await e(!1)}function $i(t,e){const n=w(t);n.lu.has(e.targetId)||(n.lu.set(e.targetId,e),Wi(n)?zi(n):os(n).xo()&&Hi(n,e))}function Ki(t,e){const n=w(t),i=os(n);n.lu.delete(e),i.xo()&&Gi(n,e),0===n.lu.size&&(i.xo()?i.Mo():Qi(n)&&n.wu.set(\"Unknown\"))}function Hi(t,e){t.mu.Z(e.targetId),os(t).jo(e)}function Gi(t,e){t.mu.Z(e),os(t).Wo(e)}function zi(t){t.mu=new ln({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>t.lu.get(e)||null}),os(t).start(),t.wu.ru()}function Wi(t){return Qi(t)&&!os(t).Co()&&t.lu.size>0}function Qi(t){return 0===w(t).fu.size}function Xi(t){t.mu=void 0}async function Yi(t,e,n){if(!jn(e))throw e;t.fu.add(1),await qi(t),t.wu.set(\"Offline\"),n||(n=(()=>ai(t.localStore))),t.asyncQueue.enqueueRetryable(async()=>{f(\"RemoteStore\",\"Retrying IndexedDB access\"),await n(),t.fu.delete(1),await ji(t)})}function Ji(t,e){return e().catch(n=>Yi(t,n,e))}async function Zi(t){const e=w(t),n=as(e);let i=e.hu.length>0?e.hu[e.hu.length-1].batchId:-1;for(;ts(e);)try{const s=await ui(e.localStore,i);if(null===s){0===e.hu.length&&n.Mo();break}i=s.batchId,es(e,s)}catch(t){await Yi(e,t)}ns(e)&&is(e)}function ts(t){return Qi(t)&&t.hu.length<10}function es(t,e){t.hu.push(e);const n=as(t);n.xo()&&n.Ho&&n.Jo(e.mutations)}function ns(t){return Qi(t)&&!as(t).Co()&&t.hu.length>0}function is(t){as(t).start()}async function ss(t,e){const n=w(t);n.asyncQueue.verifyOperationInProgress(),f(\"RemoteStore\",\"RemoteStore received new credentials\");const i=Qi(n);n.fu.add(3),await qi(n),i&&n.wu.set(\"Unknown\"),await n.remoteSyncer.handleCredentialChange(e),n.fu.delete(3),await ji(n)}async function rs(t,e){const n=w(t);e?(n.fu.delete(2),await ji(n)):e||(n.fu.add(2),await qi(n),n.wu.set(\"Unknown\"))}function os(t){return t.gu||(t.gu=function(t,e,n){const i=w(t);return i.eu(),new Vi(e,i.bo,i.authCredentials,i.appCheckCredentials,i.M,n)\n/**\n * @license\n * Copyright 2018 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */}(t.datastore,t.asyncQueue,{Hr:async function(t){t.lu.forEach((e,n)=>{Hi(t,e)})}.bind(null,t),Yr:async function(t,e){Xi(t),Wi(t)?(t.wu.au(e),zi(t)):t.wu.set(\"Unknown\")}.bind(null,t),Qo:async function(t,e,n){if(t.wu.set(\"Online\"),e instanceof un&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const i of e.targetIds)t.lu.has(i)&&(await t.remoteSyncer.rejectListen(i,n),t.lu.delete(i),t.mu.removeTarget(i))}(t,e)}catch(n){f(\"RemoteStore\",\"Failed to remove targets %s: %s \",e.targetIds.join(\",\"),n),await Yi(t,n)}else if(e instanceof an?t.mu.ut(e):e instanceof cn?t.mu._t(e):t.mu.ht(e),!n.isEqual(x.min()))try{const i=await ai(t.localStore);n.compareTo(i)>=0&&await function(t,e){const n=t.mu.yt(e);return n.targetChanges.forEach((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.lu.get(i);s&&t.lu.set(i,s.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(e=>{const n=t.lu.get(e);if(!n)return;t.lu.set(e,n.withResumeToken($.EMPTY_BYTE_STRING,n.snapshotVersion)),Gi(t,e);const i=new Hn(n.target,e,1,n.sequenceNumber);Hi(t,i)}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){f(\"RemoteStore\",\"Failed to raise snapshot:\",e),await Yi(t,e)}}.bind(null,t)}),t.du.push(async e=>{e?(t.gu.ko(),Wi(t)?zi(t):t.wu.set(\"Unknown\")):(await t.gu.stop(),Xi(t))})),t.gu}function as(t){return t.yu||(t.yu=function(t,e,n){const i=w(t);return i.eu(),new Pi(e,i.bo,i.authCredentials,i.appCheckCredentials,i.M,n)}(t.datastore,t.asyncQueue,{Hr:async function(t){as(t).Zo()}.bind(null,t),Yr:async function(t,e){e&&as(t).Ho&&await async function(t,e){if(Be(n=e.code)&&n!==E.ABORTED){const n=t.hu.shift();as(t).ko(),await Ji(t,()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e)),await Zi(t)}var n}(t,e),ns(t)&&is(t)}.bind(null,t),Xo:async function(t){const e=as(t);for(const n of t.hu)e.Jo(n.mutations)}.bind(null,t),Yo:async function(t,e,n){const i=t.hu.shift(),s=$n.from(i,e,n);await Ji(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await Zi(t)}.bind(null,t)}),t.du.push(async e=>{e?(t.yu.ko(),await Zi(t)):(await t.yu.stop(),t.hu.length>0&&(f(\"RemoteStore\",`Stopping write stream with ${t.hu.length} pending writes`),t.hu=[]))})),t.yu\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */}class cs{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new T,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(t=>{})}static createAndSchedule(t,e,n,i,s){const r=Date.now()+n,o=new cs(t,e,r,i,s);return o.start(n),o}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new b(E.CANCELLED,\"Operation cancelled\"+(t?\": \"+t:\"\"))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function us(t,e){if(p(\"AsyncQueue\",`${e}: ${t}`),jn(t))return new b(E.UNAVAILABLE,`${e}: ${t}`);throw t}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class hs{constructor(t){this.comparator=t?(e,n)=>t(e,n)||et.comparator(e.key,n.key):(t,e)=>et.comparator(t.key,e.key),this.keyedMap=Ye(),this.sortedSet=new $e(this.comparator)}static emptySet(t){return new hs(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof hs))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(!t.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?\"DocumentSet ()\":\"DocumentSet (\\n  \"+t.join(\"  \\n\")+\"\\n)\"}copy(t,e){const n=new hs;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class ls{constructor(){this.pu=new $e(et.comparator)}track(t){const e=t.doc.key,n=this.pu.get(e);n?0!==t.type&&3===n.type?this.pu=this.pu.insert(e,t):3===t.type&&1!==n.type?this.pu=this.pu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.pu=this.pu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.pu=this.pu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.pu=this.pu.remove(e):1===t.type&&2===n.type?this.pu=this.pu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.pu=this.pu.insert(e,{type:2,doc:t.doc}):y():this.pu=this.pu.insert(e,t)}Iu(){const t=[];return this.pu.inorderTraversal((e,n)=>{t.push(n)}),t}}class ds{constructor(t,e,n,i,s,r,o,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(t,e,n,i){const s=[];return e.forEach(t=>{s.push({type:0,doc:t})}),new ds(t,e,hs.emptySet(e),s,n,i,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Zt(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class fs{constructor(){this.Tu=void 0,this.listeners=[]}}class ps{constructor(){this.queries=new qe(t=>te(t),Zt),this.onlineState=\"Unknown\",this.Eu=new Set}}async function gs(t,e){const n=w(t),i=e.query;let s=!1,r=n.queries.get(i);if(r||(s=!0,r=new fs),s)try{r.Tu=await n.onListen(i)}catch(t){const n=us(t,`Initialization of query '${ee(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,r),r.listeners.push(e),e.Au(n.onlineState),r.Tu&&e.Ru(r.Tu)&&ys(n)}async function ms(t,e){const n=w(t),i=e.query;let s=!1;const r=n.queries.get(i);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),s=0===r.listeners.length)}if(s)return n.queries.delete(i),n.onUnlisten(i)}function ys(t){t.Eu.forEach(t=>{t.next()})}class vs{constructor(t,e,n){this.query=t,this.Pu=e,this.bu=!1,this.Vu=null,this.onlineState=\"Unknown\",this.options=n||{}}Ru(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new ds(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.bu?this.vu(t)&&(this.Pu.next(t),e=!0):this.Su(t,this.onlineState)&&(this.Du(t),e=!0),this.Vu=t,e}onError(t){this.Pu.error(t)}Au(t){this.onlineState=t;let e=!1;return this.Vu&&!this.bu&&this.Su(this.Vu,t)&&(this.Du(this.Vu),e=!0),e}Su(t,e){if(!t.fromCache)return!0;const n=\"Offline\"!==e;return!(this.options.Cu&&n||t.docs.isEmpty()&&\"Offline\"!==e)}vu(t){if(t.docChanges.length>0)return!0;const e=this.Vu&&this.Vu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Du(t){t=ds.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.bu=!0,this.Pu.next(t)}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass ws{constructor(t){this.key=t}}class Es{constructor(t){this.key=t}}class bs{constructor(t,e){this.query=t,this.$u=e,this.Bu=null,this.current=!1,this.Lu=en(),this.mutatedKeys=en(),this.Uu=se(t),this.qu=new hs(this.Uu)}get Ku(){return this.$u}Gu(t,e){const n=e?e.Qu:new ls,i=e?e.qu:this.qu;let s=e?e.mutatedKeys:this.mutatedKeys,r=i,o=!1;const a=Ht(this.query)&&i.size===this.query.limit?i.last():null,c=Gt(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((t,e)=>{const u=i.get(t),h=ne(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.ju(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.Uu(h,a)>0||c&&this.Uu(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(r=r.add(h),s=d?s.add(t):s.delete(t)):(r=r.delete(t),s=s.delete(t)))}),Ht(this.query)||Gt(this.query))for(;r.size>this.query.limit;){const t=Ht(this.query)?r.last():r.first();r=r.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{qu:r,Qu:n,ni:o,mutatedKeys:s}}ju(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const i=this.qu;this.qu=t.qu,this.mutatedKeys=t.mutatedKeys;const s=t.Qu.Iu();s.sort((t,e)=>(function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return y()}};return n(t)-n(e)}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */)(t.type,e.type)||this.Uu(t.doc,e.doc)),this.Wu(n);const r=e?this.zu():[],o=0===this.Lu.size&&this.current?1:0,a=o!==this.Bu;return this.Bu=o,0!==s.length||a?{snapshot:new ds(this.query,t.qu,i,s,t.mutatedKeys,0===o,a,!1),Hu:r}:{Hu:r}}Au(t){return this.current&&\"Offline\"===t?(this.current=!1,this.applyChanges({qu:this.qu,Qu:new ls,mutatedKeys:this.mutatedKeys,ni:!1},!1)):{Hu:[]}}Ju(t){return!this.$u.has(t)&&!!this.qu.has(t)&&!this.qu.get(t).hasLocalMutations}Wu(t){t&&(t.addedDocuments.forEach(t=>this.$u=this.$u.add(t)),t.modifiedDocuments.forEach(t=>{}),t.removedDocuments.forEach(t=>this.$u=this.$u.delete(t)),this.current=t.current)}zu(){if(!this.current)return[];const t=this.Lu;this.Lu=en(),this.qu.forEach(t=>{this.Ju(t.key)&&(this.Lu=this.Lu.add(t.key))});const e=[];return t.forEach(t=>{this.Lu.has(t)||e.push(new Es(t))}),this.Lu.forEach(n=>{t.has(n)||e.push(new ws(n))}),e}Yu(t){this.$u=t.li,this.Lu=en();const e=this.Gu(t.documents);return this.applyChanges(e,!0)}Xu(){return ds.fromInitialDocuments(this.query,this.qu,this.mutatedKeys,0===this.Bu)}}class Ts{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Is{constructor(t){this.key=t,this.Zu=!1}}class Ss{constructor(t,e,n,i,s,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.ta={},this.ea=new qe(t=>te(t),Zt),this.na=new Map,this.sa=new Set,this.ia=new $e(et.comparator),this.ra=new Map,this.oa=new mi,this.ua={},this.aa=new Map,this.ca=Jn.yn(),this.onlineState=\"Unknown\",this.ha=void 0}get isPrimaryClient(){return!0===this.ha}}async function Cs(t,e,n,i){t.la=((e,n,i)=>(async function(t,e,n,i){let s=e.view.Gu(n);s.ni&&(s=await di(t.localStore,e.query,!1).then(({documents:t})=>e.view.Gu(t,s)));const r=i&&i.targetChanges.get(e.targetId),o=e.view.applyChanges(s,t.isPrimaryClient,r);return Os(t,e.targetId,o.Hu),o.snapshot})(t,e,n,i));const s=await di(t.localStore,e,!0),r=new bs(e,s.li),o=r.Gu(s.documents),a=on.createSynthesizedTargetChangeForCurrentChange(n,i&&\"Offline\"!==t.onlineState),c=r.applyChanges(o,t.isPrimaryClient,a);Os(t,n,c.Hu);const u=new Ts(e,n,r);return t.ea.set(e,u),t.na.has(n)?t.na.get(n).push(e):t.na.set(n,[e]),c.snapshot}async function _s(t,e){const n=w(t);try{const i=await function(t,e){const n=w(t),i=e.snapshotVersion;let s=n.ii;return n.persistence.runTransaction(\"Apply remote event\",\"readwrite-primary\",t=>{const r=n.ui.newChangeBuffer({trackRemovals:!0});s=n.ii;const o=[];e.targetChanges.forEach((r,a)=>{const c=s.get(a);if(!c)return;o.push(n.fs.removeMatchingKeys(t,r.removedDocuments,a).next(()=>n.fs.addMatchingKeys(t,r.addedDocuments,a)));let u=c.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(a)?u=u.withResumeToken($.EMPTY_BYTE_STRING,x.min()).withLastLimboFreeSnapshotVersion(x.min()):r.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(r.resumeToken,i)),s=s.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,r)&&o.push(n.fs.updateTargetData(t,u))});let a=Qe();if(e.documentUpdates.forEach(i=>{e.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,i))}),o.push(ci(t,r,e.documentUpdates).next(t=>{a=t})),!i.isEqual(x.min())){const e=n.fs.getLastRemoteSnapshotVersion(t).next(e=>n.fs.setTargetsMetadata(t,t.currentSequenceNumber,i));o.push(e)}return Bn.waitFor(o).next(()=>r.apply(t)).next(()=>n.ci.Gs(t,a)).next(()=>a)}).then(t=>(n.ii=s,t))}(n.localStore,e);e.targetChanges.forEach((t,e)=>{const i=n.ra.get(e);i&&(v(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?i.Zu=!0:t.modifiedDocuments.size>0?v(i.Zu):t.removedDocuments.size>0&&(v(i.Zu),i.Zu=!1))}),await Vs(n,i,e)}catch(t){await Zn(t)}}function As(t,e,n){const i=w(t);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const t=[];i.ea.forEach((n,i)=>{const s=i.view.Au(e);s.snapshot&&t.push(s.snapshot)}),function(t,e){const n=w(t);n.onlineState=e;let i=!1;n.queries.forEach((t,n)=>{for(const t of n.listeners)t.Au(e)&&(i=!0)}),i&&ys(n)}(i.eventManager,e),t.length&&i.ta.Qo(t),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function Ds(t,e){const n=w(t),i=e.batch.batchId;try{const s=await function(t,e){const n=w(t);return n.persistence.runTransaction(\"Acknowledge batch\",\"readwrite-primary\",t=>{const i=e.batch.keys(),s=n.ui.newChangeBuffer({trackRemovals:!0});return function(t,e,n,i){const s=n.batch,r=s.keys();let o=Bn.resolve();return r.forEach(t=>{o=o.next(()=>i.getEntry(e,t)).next(e=>{const r=n.docVersions.get(t);v(null!==r),e.version.compareTo(r)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),i.addEntry(e)))})}),o.next(()=>t.Bs.removeMutationBatch(e,s))}(n,t,e,s).next(()=>s.apply(t)).next(()=>n.Bs.performConsistencyCheck(t)).next(()=>n.ci.Ks(t,i))})}(n.localStore,e);ks(n,i,null),Ns(n,i),n.sharedClientState.updateMutationState(i,\"acknowledged\"),await Vs(n,s)}catch(t){await Zn(t)}}function Ns(t,e){(t.aa.get(e)||[]).forEach(t=>{t.resolve()}),t.aa.delete(e)}function ks(t,e,n){const i=w(t);let s=i.ua[i.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),i.ua[i.currentUser.toKey()]=s}}function Ls(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const i of t.na.get(e))t.ea.delete(i),n&&t.ta.fa(i,n);t.na.delete(e),t.isPrimaryClient&&t.oa.Pi(e).forEach(e=>{t.oa.containsKey(e)||Rs(t,e)})}function Rs(t,e){t.sa.delete(e.path.canonicalString());const n=t.ia.get(e);null!==n&&(Ki(t.remoteStore,n),t.ia=t.ia.remove(e),t.ra.delete(n),Ms(t))}function Os(t,e,n){for(const i of n)i instanceof ws?(t.oa.addReference(i.key,e),xs(t,i)):i instanceof Es?(f(\"SyncEngine\",\"Document no longer in limbo: \"+i.key),t.oa.removeReference(i.key,e),t.oa.containsKey(i.key)||Rs(t,i.key)):y()}function xs(t,e){const n=e.key,i=n.path.canonicalString();t.ia.get(n)||t.sa.has(i)||(f(\"SyncEngine\",\"New document in limbo: \"+n),t.sa.add(i),Ms(t))}function Ms(t){for(;t.sa.size>0&&t.ia.size<t.maxConcurrentLimboResolutions;){const e=t.sa.values().next().value;t.sa.delete(e);const n=new et(U.fromString(e)),i=t.ca.next();t.ra.set(i,new Is(n)),t.ia=t.ia.insert(n,i),$i(t.remoteStore,new Hn(Yt(Kt(n.path)),i,2,D.A))}}async function Vs(t,e,n){const i=w(t),s=[],r=[],o=[];i.ea.isEmpty()||(i.ea.forEach((t,a)=>{o.push(i.la(a,e,n).then(t=>{if(t){i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,t.fromCache?\"not-current\":\"current\"),s.push(t);const e=ni.Ys(a.targetId,t);r.push(e)}}))}),await Promise.all(o),i.ta.Qo(s),await async function(t,e){const n=w(t);try{await n.persistence.runTransaction(\"notifyLocalViewChanges\",\"readwrite\",t=>Bn.forEach(e,e=>Bn.forEach(e.Hs,i=>n.persistence.referenceDelegate.addReference(t,e.targetId,i)).next(()=>Bn.forEach(e.Js,i=>n.persistence.referenceDelegate.removeReference(t,e.targetId,i)))))}catch(t){if(!jn(t))throw t;f(\"LocalStore\",\"Failed to update sequence numbers: \"+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ii.get(e),i=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(i);n.ii=n.ii.insert(e,s)}}}(i.localStore,r))}function Ps(t){const e=w(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=_s.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(t,e){const n=w(t),i=n.ra.get(e);if(i&&i.Zu)return en().add(i.key);{let t=en();const i=n.na.get(e);if(!i)return t;for(const e of i){const i=n.ea.get(e);t=t.unionWith(i.view.Ku)}return t}}.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=async function(t,e,n){const i=w(t);i.sharedClientState.updateQueryState(e,\"rejected\",n);const s=i.ra.get(e),r=s&&s.key;if(r){let t=new $e(et.comparator);t=t.insert(r,yt.newNoDocument(r,x.min()));const n=en().add(r),s=new rn(x.min(),new Map,new Ge(L),t,n);await _s(i,s),i.ia=i.ia.remove(r),i.ra.delete(e),Ms(i)}else await li(i.localStore,e,!1).then(()=>Ls(i,e,n)).catch(Zn)}.bind(null,e),e.ta.Qo=function(t,e){const n=w(t);let i=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.listeners)e.Ru(t)&&(i=!0);s.Tu=t}}i&&ys(n)}.bind(null,e.eventManager),e.ta.fa=function(t,e,n){const i=w(t),s=i.queries.get(e);if(s)for(const t of s.listeners)t.onError(n);i.queries.delete(e)}.bind(null,e.eventManager),e}function Fs(t){const e=w(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Ds.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=async function(t,e,n){const i=w(t);try{const t=await function(t,e){const n=w(t);return n.persistence.runTransaction(\"Reject batch\",\"readwrite-primary\",t=>{let i;return n.Bs.lookupMutationBatch(t,e).next(e=>(v(null!==e),i=e.keys(),n.Bs.removeMutationBatch(t,e))).next(()=>n.Bs.performConsistencyCheck(t)).next(()=>n.ci.Ks(t,i))})}(i.localStore,e);ks(i,e,n),Ns(i,e),i.sharedClientState.updateMutationState(e,\"rejected\",n),await Vs(i,t)}catch(n){await Zn(n)}}.bind(null,e),e}class Us{constructor(){this.synchronizeTabs=!1}async initialize(t){this.M=Oi(t.databaseInfo.databaseId),this.sharedClientState=this._a(t),this.persistence=this.wa(t),await this.persistence.start(),this.gcScheduler=this.ma(t),this.localStore=this.ga(t)}ma(t){return null}ga(t){return ri(this.persistence,new ii,t.initialUser,this.M)}wa(t){return new Ti(Si.zi,this.M)}_a(t){return new _i}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Bs{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=(t=>As(this.syncEngine,t,1)),this.remoteStore.remoteSyncer.handleCredentialChange=async function(t,e){const n=w(t);if(!n.currentUser.isEqual(e)){f(\"SyncEngine\",\"User change. New user:\",e.toKey());const t=await oi(n.localStore,e);n.currentUser=e,function(t,e){t.aa.forEach(t=>{t.forEach(t=>{t.reject(new b(E.CANCELLED,\"'waitForPendingWrites' promise is rejected due to a user change.\"))})}),t.aa.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Vs(n,t.hi)}}.bind(null,this.syncEngine),await rs(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new ps}createDatastore(t){const e=Oi(t.databaseInfo.databaseId),n=(i=t.databaseInfo,new Li(i));var i;return function(t,e,n,i){return new Fi(t,e,n,i)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,i=t.asyncQueue,s=(t=>As(this.syncEngine,t,0)),r=Di.vt()?new Di:new Ai,new Bi(e,n,i,s,r);var e,n,i,s,r}createSyncEngine(t,e){return function(t,e,n,i,s,r,o){const a=new Ss(t,e,n,i,s,r);return o&&(a.ha=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=w(t);f(\"RemoteStore\",\"RemoteStore shutting down.\"),e.fu.add(5),await qi(e),e._u.shutdown(),e.wu.set(\"Unknown\")}(this.remoteStore)}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass js{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.pa(this.observer.next,t)}error(t){this.observer.error?this.pa(this.observer.error,t):console.error(\"Uncaught Error in snapshot listener:\",t)}Ia(){this.muted=!0}pa(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass qs{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=u.UNAUTHENTICATED,this.clientId=k.R(),this.authCredentialListener=(()=>Promise.resolve()),this.appCheckCredentialListener=(()=>Promise.resolve()),this.authCredentials.start(n,async t=>{f(\"FirestoreClient\",\"Received user=\",t.uid),await this.authCredentialListener(t),this.user=t}),this.appCheckCredentials.start(n,t=>(f(\"FirestoreClient\",\"Received new app check token=\",t),this.appCheckCredentialListener(t,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new b(E.FAILED_PRECONDITION,\"The client has already been terminated.\")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new T;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=us(e,\"Failed to shutdown persistence\");t.reject(n)}}),t.promise}}async function $s(t,e){t.asyncQueue.verifyOperationInProgress(),f(\"FirestoreClient\",\"Initializing OfflineComponentProvider\");const n=await t.getConfiguration();await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener(async t=>{i.isEqual(t)||(await oi(e.localStore,t),i=t)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t.offlineComponents=e}async function Ks(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Hs(t);f(\"FirestoreClient\",\"Initializing OnlineComponentProvider\");const i=await t.getConfiguration();await e.initialize(n,i),t.setCredentialChangeListener(t=>ss(e.remoteStore,t)),t.setAppCheckTokenChangeListener((t,n)=>ss(e.remoteStore,n)),t.onlineComponents=e}async function Hs(t){return t.offlineComponents||(f(\"FirestoreClient\",\"Using default OfflineComponentProvider\"),await $s(t,new Us)),t.offlineComponents}async function Gs(t){return t.onlineComponents||(f(\"FirestoreClient\",\"Using default OnlineComponentProvider\"),await Ks(t,new Bs)),t.onlineComponents}function zs(t){return Gs(t).then(t=>t.syncEngine)}async function Ws(t){const e=await Gs(t),n=e.eventManager;return n.onListen=async function(t,e){const n=Ps(t);let i,s;const r=n.ea.get(e);if(r)i=r.targetId,n.sharedClientState.addLocalQueryTarget(i),s=r.view.Xu();else{const t=await hi(n.localStore,Yt(e));n.isPrimaryClient&&$i(n.remoteStore,t);const r=n.sharedClientState.addLocalQueryTarget(t.targetId);i=t.targetId,s=await Cs(n,e,i,\"current\"===r)}return s}.bind(null,e.syncEngine),n.onUnlisten=async function(t,e){const n=w(t),i=n.ea.get(e),s=n.na.get(i.targetId);if(s.length>1)return n.na.set(i.targetId,s.filter(t=>!Zt(t,e))),void n.ea.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await li(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),Ki(n.remoteStore,i.targetId),Ls(n,i.targetId)}).catch(Zn)):(Ls(n,i.targetId),await li(n.localStore,i.targetId,!0))}.bind(null,e.syncEngine),n}function Qs(t,e,n={}){const i=new T;return t.asyncQueue.enqueueAndForget(async()=>(function(t,e,n,i,s){const r=new js({next:n=>{e.enqueueAndForget(()=>ms(t,o)),n.fromCache&&\"server\"===i.source?s.reject(new b(E.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to \"server\" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new vs(n,r,{includeMetadataChanges:!0,Cu:!0});return gs(t,o)})(await Ws(t),t.asyncQueue,e,n,i)),i.promise}const Xs=new Map;\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function Ys(t,e,n){if(!n)throw new b(E.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Js(t){if(!et.isDocumentKey(t))throw new b(E.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Zs(t){if(et.isDocumentKey(t))throw new b(E.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function tr(t){if(void 0===t)return\"undefined\";if(null===t)return\"null\";if(\"string\"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(\"number\"==typeof t||\"boolean\"==typeof t)return\"\"+t;if(\"object\"==typeof t){if(t instanceof Array)return\"an array\";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:\"an object\"}}return\"function\"==typeof t?\"a function\":y()}function er(t,e){if(\"_delegate\"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new b(E.INVALID_ARGUMENT,\"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?\");{const n=tr(t);throw new b(E.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass nr{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new b(E.INVALID_ARGUMENT,\"Can't provide ssl option if host option is not set\");this.host=\"firestore.googleapis.com\",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new b(E.INVALID_ARGUMENT,\"cacheSizeBytes must be at least 1048576\");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(t,e,n,i){if(!0===e&&!0===i)throw new b(E.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}(\"experimentalForceLongPolling\",t.experimentalForceLongPolling,\"experimentalAutoDetectLongPolling\",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class ir{constructor(t,e,n){this._authCredentials=e,this._appCheckCredentials=n,this.type=\"firestore-lite\",this._persistenceKey=\"(lite)\",this._settings=new nr({}),this._settingsFrozen=!1,t instanceof Y?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,[\"projectId\"]))throw new b(E.INVALID_ARGUMENT,'\"projectId\" not provided in firebase.initializeApp.');return new Y(t.options.projectId)}(t))}get app(){if(!this._app)throw new b(E.FAILED_PRECONDITION,\"Firestore was not initialized using the Firebase SDK. 'app' is not available\");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new b(E.FAILED_PRECONDITION,\"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.\");this._settings=new nr(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new S;switch(t.type){case\"gapi\":const e=t.client;return v(!(\"object\"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new _(e,t.sessionIndex||\"0\",t.iamToken||null);case\"provider\":return t.client;default:throw new b(E.INVALID_ARGUMENT,\"makeAuthCredentialsProvider failed due to invalid credential type\")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Xs.get(t);e&&(f(\"ComponentProvider\",\"Removing Datastore\"),Xs.delete(t),e.terminate())}(this),Promise.resolve()}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass sr{constructor(t,e,n){this.converter=e,this._key=n,this.type=\"document\",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new or(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new sr(this.firestore,t,this._key)}}class rr{constructor(t,e,n){this.converter=e,this._query=n,this.type=\"query\",this.firestore=t}withConverter(t){return new rr(this.firestore,t,this._query)}}class or extends rr{constructor(t,e,n){super(t,e,Kt(n)),this._path=n,this.type=\"collection\"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new sr(this.firestore,null,new et(t))}withConverter(t){return new or(this.firestore,t,this._path)}}function ar(t,e,...n){if(t=Object(o.g)(t),Ys(\"collection\",\"path\",e),t instanceof ir){const i=U.fromString(e,...n);return Zs(i),new or(t,null,i)}{if(!(t instanceof sr||t instanceof or))throw new b(E.INVALID_ARGUMENT,\"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore\");const i=t._path.child(U.fromString(e,...n));return Zs(i),new or(t.firestore,null,i)}}function cr(t,e,...n){if(t=Object(o.g)(t),1===arguments.length&&(e=k.R()),Ys(\"doc\",\"path\",e),t instanceof ir){const i=U.fromString(e,...n);return Js(i),new sr(t,null,new et(i))}{if(!(t instanceof sr||t instanceof or))throw new b(E.INVALID_ARGUMENT,\"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore\");const i=t._path.child(U.fromString(e,...n));return Js(i),new sr(t.firestore,t instanceof or?t.converter:null,new et(i))}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass ur{constructor(){this.ka=Promise.resolve(),this.Ma=[],this.Oa=!1,this.Fa=[],this.$a=null,this.Ba=!1,this.La=!1,this.Ua=[],this.Do=new xi(this,\"async_queue_retry\"),this.qa=(()=>{const t=Ri();t&&f(\"AsyncQueue\",\"Visibility state changed to \"+t.visibilityState),this.Do.Ao()});const t=Ri();t&&\"function\"==typeof t.addEventListener&&t.addEventListener(\"visibilitychange\",this.qa)}get isShuttingDown(){return this.Oa}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Ka(),this.Ga(t)}enterRestrictedMode(t){if(!this.Oa){this.Oa=!0,this.La=t||!1;const e=Ri();e&&\"function\"==typeof e.removeEventListener&&e.removeEventListener(\"visibilitychange\",this.qa)}}enqueue(t){if(this.Ka(),this.Oa)return new Promise(()=>{});const e=new T;return this.Ga(()=>this.Oa&&this.La?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Ma.push(t),this.Qa()))}async Qa(){if(0!==this.Ma.length){try{await this.Ma[0](),this.Ma.shift(),this.Do.reset()}catch(t){if(!jn(t))throw t;f(\"AsyncQueue\",\"Operation failed with retryable error: \"+t)}this.Ma.length>0&&this.Do.To(()=>this.Qa())}}Ga(t){const e=this.ka.then(()=>(this.Ba=!0,t().catch(t=>{throw this.$a=t,this.Ba=!1,p(\"INTERNAL UNHANDLED ERROR: \",function(t){let e=t.message||\"\";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+\"\\n\"+t.stack),e}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */(t)),t}).then(t=>(this.Ba=!1,t))));return this.ka=e,e}enqueueAfterDelay(t,e,n){this.Ka(),this.Ua.indexOf(t)>-1&&(e=0);const i=cs.createAndSchedule(this,t,e,n,t=>this.ja(t));return this.Fa.push(i),i}Ka(){this.$a&&y()}verifyOperationInProgress(){}async Wa(){let t;do{t=this.ka,await t}while(t!==this.ka)}za(t){for(const e of this.Fa)if(e.timerId===t)return!0;return!1}Ha(t){return this.Wa().then(()=>{this.Fa.sort((t,e)=>t.targetTimeMs-e.targetTimeMs);for(const e of this.Fa)if(e.skipDelay(),\"all\"!==t&&e.timerId===t)break;return this.Wa()})}Ja(t){this.Ua.push(t)}ja(t){const e=this.Fa.indexOf(t);this.Fa.splice(e,1)}}class hr extends ir{constructor(t,e,n){super(t,e,n),this.type=\"firestore\",this._queue=new ur,this._persistenceKey=\"name\"in t?t.name:\"[DEFAULT]\"}_terminate(){return this._firestoreClient||fr(this),this._firestoreClient.terminate()}}function lr(t=Object(i.e)()){return Object(i.b)(t,\"firestore\").getImmediate()}function dr(t){return t._firestoreClient||fr(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function fr(t){var e;const n=t._freezeSettings(),i=function(t,e,n,i){return new X(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||\"\",t._persistenceKey,n);t._firestoreClient=new qs(t._authCredentials,t._appCheckCredentials,t._queue,i)}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass pr{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new b(E.INVALID_ARGUMENT,\"Invalid field name at argument $(i + 1). Field names must not be empty.\");this._internalPath=new j(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass gr{constructor(t){this._byteString=t}static fromBase64String(t){try{return new gr($.fromBase64String(t))}catch(t){throw new b(E.INVALID_ARGUMENT,\"Failed to construct data from Base64 string: \"+t)}}static fromUint8Array(t){return new gr($.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return\"Bytes(base64: \"+this.toBase64()+\")\"}isEqual(t){return this._byteString.isEqual(t._byteString)}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class mr{constructor(t){this._methodName=t}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class yr{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new b(E.INVALID_ARGUMENT,\"Latitude must be a number between -90 and 90, but was: \"+t);if(!isFinite(e)||e<-180||e>180)throw new b(E.INVALID_ARGUMENT,\"Longitude must be a number between -180 and 180, but was: \"+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return L(this._lat,t._lat)||L(this._long,t._long)}}\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */const vr=/^__.*__$/;class wr{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Le(t,this.data,this.fieldMask,e,this.fieldTransforms):new ke(t,this.data,e,this.fieldTransforms)}}function Er(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw y()}}class br{constructor(t,e,n,i,s,r){this.settings=t,this.databaseId=e,this.M=n,this.ignoreUndefinedProperties=i,void 0===s&&this.Ya(),this.fieldTransforms=s||[],this.fieldMask=r||[]}get path(){return this.settings.path}get Xa(){return this.settings.Xa}Za(t){return new br(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.M,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}tc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.Za({path:n,ec:!1});return i.nc(t),i}sc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.Za({path:n,ec:!1});return i.Ya(),i}ic(t){return this.Za({path:void 0,ec:!0})}rc(t){return Rr(t,this.settings.methodName,this.settings.oc||!1,this.path,this.settings.uc)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Ya(){if(this.path)for(let t=0;t<this.path.length;t++)this.nc(this.path.get(t))}nc(t){if(0===t.length)throw this.rc(\"Document fields must not be empty\");if(Er(this.Xa)&&vr.test(t))throw this.rc('Document fields cannot begin and end with \"__\"')}}class Tr{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.M=n||Oi(t)}ac(t,e,n,i=!1){return new br({Xa:t,methodName:e,uc:n,path:j.emptyPath(),ec:!1,oc:i},this.databaseId,this.M,this.ignoreUndefinedProperties)}}function Ir(t){const e=t._freezeSettings(),n=Oi(t._databaseId);return new Tr(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Sr(t,e,n,i,s,r={}){const o=t.ac(r.merge||r.mergeFields?2:0,e,n,s);Dr(\"Data must be an object, but it was:\",o,i);const a=_r(i,o);let c,u;if(r.merge)c=new q(o.fieldMask),u=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const i of r.mergeFields){const s=Nr(e,i,n);if(!o.contains(s))throw new b(E.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Or(t,s)||t.push(s)}c=new q(t),u=o.fieldTransforms.filter(t=>c.covers(t.field))}else c=null,u=o.fieldTransforms;return new wr(new gt(a),c,u)}function Cr(t,e){if(Ar(t=Object(o.g)(t)))return Dr(\"Unsupported field value:\",e,t),_r(t,e);if(t instanceof mr)return function(t,e){if(!Er(e.Xa))throw e.rc(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.rc(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.ec&&4!==e.Xa)throw e.rc(\"Nested arrays are not supported\");return function(t,e){const n=[];let i=0;for(const s of t){let t=Cr(s,e.ic(i));null==t&&(t={nullValue:\"NULL_VALUE\"}),n.push(t),i++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(o.g)(t)))return{nullValue:\"NULL_VALUE\"};if(\"number\"==typeof t)return ce(e.M,t);if(\"boolean\"==typeof t)return{booleanValue:t};if(\"string\"==typeof t)return{stringValue:t};if(t instanceof Date){const n=O.fromDate(t);return{timestampValue:yn(e.M,n)}}if(t instanceof O){const n=new O(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:yn(e.M,n)}}if(t instanceof yr)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof gr)return{bytesValue:vn(e.M,t._byteString)};if(t instanceof sr){const n=e.databaseId,i=t.firestore._databaseId;if(!i.isEqual(n))throw e.rc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:En(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.rc(`Unsupported field value: ${tr(t)}`)}(t,e)}function _r(t,e){const n={};return P(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):V(t,(t,i)=>{const s=Cr(i,e.tc(t));null!=s&&(n[t]=s)}),{mapValue:{fields:n}}}function Ar(t){return!(\"object\"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof O||t instanceof yr||t instanceof gr||t instanceof sr||t instanceof mr)}function Dr(t,e,n){if(!Ar(n)||!function(t){return\"object\"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const i=tr(n);throw\"an object\"===i?e.rc(t+\" a custom object\"):e.rc(t+\" \"+i)}}function Nr(t,e,n){if((e=Object(o.g)(e))instanceof pr)return e._internalPath;if(\"string\"==typeof e)return Lr(t,e);throw Rr(\"Field path arguments must be of type string or \",t,!1,void 0,n)}const kr=new RegExp(\"[~\\\\*/\\\\[\\\\]]\");function Lr(t,e,n){if(e.search(kr)>=0)throw Rr(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new pr(...e.split(\".\"))._internalPath}catch(i){throw Rr(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Rr(t,e,n,i,s){const r=i&&!i.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=\" (via `toFirestore()`)\"),a+=\". \";let c=\"\";return(r||o)&&(c+=\" (found\",r&&(c+=` in field ${i}`),o&&(c+=` in document ${s}`),c+=\")\"),new b(E.INVALID_ARGUMENT,a+t+c)}function Or(t,e){return t.some(t=>t.isEqual(e))}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class xr{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new sr(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Mr(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Vr(\"DocumentSnapshot.get\",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Mr extends xr{data(){return super.data()}}function Vr(t,e){return\"string\"==typeof e?Lr(t,e):e instanceof pr?e._internalPath:e._delegate._internalPath}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */class Pr{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Fr extends xr{constructor(t,e,n,i,s,r){super(t,e,n,i,r),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Ur(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Vr(\"DocumentSnapshot.get\",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Ur extends Fr{data(t={}){return super.data(t)}}class Br{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new Pr(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Ur(this._firestore,this._userDataWriter,n.key,n,new Pr(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new b(E.INVALID_ARGUMENT,\"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().\");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map(n=>({type:\"added\",doc:new Ur(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Pr(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(t=>e||3!==t.type).map(e=>{const i=new Ur(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Pr(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,r=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(r=(n=n.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return\"added\";case 2:case 3:return\"modified\";case 1:return\"removed\";default:return y()}}(e.type),doc:i,oldIndex:s,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction jr(t){if(Gt(t)&&0===t.explicitOrderBy.length)throw new b(E.UNIMPLEMENTED,\"limitToLast() queries require specifying at least one orderBy() clause\")}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass qr{convertValue(t,e=\"none\"){switch(nt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return G(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(z(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw y()}}convertObject(t,e){const n={};return V(t.fields,(t,i)=>{n[t]=this.convertValue(i,e)}),n}convertGeoPoint(t){return new yr(G(t.latitude),G(t.longitude))}convertArray(t,e){return(t.values||[]).map(t=>this.convertValue(t,e))}convertServerTimestamp(t,e){switch(e){case\"previous\":const n=function t(e){const n=e.mapValue.fields.__previous_value__;return W(n)?t(n):n}(t);return null==n?null:this.convertValue(n,e);case\"estimate\":return this.convertTimestamp(Q(t));default:return null}}convertTimestamp(t){const e=H(t);return new O(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=U.fromString(t);v(Mn(n));const i=new Y(n.get(1),n.get(3)),s=new et(n.popFirst(5));return i.isEqual(e)||p(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */function $r(t,e,n){let i;return i=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}class Kr extends qr{constructor(t){super(),this.firestore=t}convertBytes(t){return new gr(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new sr(this.firestore,null,e)}}function Hr(t){const e=er((t=er(t,rr)).firestore,hr),n=dr(e),i=new Kr(e);return jr(t._query),Qs(n,t._query).then(n=>new Br(e,i,t,n))}function Gr(t){return Wr(er(t.firestore,hr),[new Me(t._key,Te.none())])}function zr(t,e){const n=er(t.firestore,hr),i=cr(t),s=$r(t.converter,e);return Wr(n,[Sr(Ir(t.firestore),\"addDoc\",i._key,s,null!==t.converter,{}).toMutation(i._key,Te.exists(!1))]).then(()=>i)}function Wr(t,e){return function(t,e){const n=new T;return t.asyncQueue.enqueueAndForget(async()=>(async function(t,e,n){const i=Fs(t);try{const s=await function(t,e){const n=w(t),i=O.now(),s=e.reduce((t,e)=>t.add(e.key),en());let r;return n.persistence.runTransaction(\"Locally write mutations\",\"readwrite\",t=>n.ci.Ks(t,s).next(s=>{r=s;const o=[];for(const t of e){const e=Ae(t,r.get(t.key));null!=e&&o.push(new Le(t.key,e,mt(e.value.mapValue),Te.exists(!0)))}return n.Bs.addMutationBatch(t,i,o,e)})).then(t=>(t.applyToLocalDocumentSet(r),{batchId:t.batchId,changes:r}))}(i.localStore,e);i.sharedClientState.addPendingMutation(s.batchId),function(t,e,n){let i=t.ua[t.currentUser.toKey()];i||(i=new $e(L)),i=i.insert(e,n),t.ua[t.currentUser.toKey()]=i}(i,s.batchId,n),await Vs(i,s.changes),await Zi(i.remoteStore)}catch(t){const e=us(t,\"Failed to persist write\");n.reject(e)}})(await zs(t),e,n)),n.promise}(dr(t),e)}!function(t,e=!0){!function(t){h=t}(i.a),Object(i.c)(new s.a(\"firestore\",(t,{options:n})=>{const i=t.getProvider(\"app\").getImmediate(),s=new hr(i,new class{constructor(t){this.t=t,this.currentUser=u.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new T;this.o=(()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new T,t.enqueueRetryable(()=>i(this.currentUser))});const r=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},o=t=>{f(\"FirebaseAuthCredentialsProvider\",\"Auth detected\"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit(t=>o(t)),setTimeout(()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(f(\"FirebaseAuthCredentialsProvider\",\"Auth not yet detected\"),s.resolve(),s=new T)}},0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(f(\"FirebaseAuthCredentialsProvider\",\"getToken aborted due to token change.\"),this.getToken()):e?(v(\"string\"==typeof e.accessToken),new I(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return v(null===t||\"string\"==typeof t),new u(t)}}(t.getProvider(\"auth-internal\")),new class{constructor(t){this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(t,e){const n=t=>{null!=t.error&&f(\"FirebaseAppCheckTokenProvider\",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.p;return this.p=t.token,f(\"FirebaseAppCheckTokenProvider\",`Received ${n?\"new\":\"existing\"} token.`),n?e(t.token):Promise.resolve()};this.o=(e=>{t.enqueueRetryable(()=>n(e))});const i=t=>{f(\"FirebaseAppCheckTokenProvider\",\"AppCheck detected\"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.g.onInit(t=>i(t)),setTimeout(()=>{if(!this.appCheck){const t=this.g.getImmediate({optional:!0});t?i(t):f(\"FirebaseAppCheckTokenProvider\",\"AppCheck not yet detected\")}},0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(t=>t?(v(\"string\"==typeof t.token),this.p=t.token,new A(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}(t.getProvider(\"app-check-internal\")));return n=Object.assign({useFetchStreams:e},n),s._setSettings(n),s},\"PUBLIC\")),Object(i.g)(c,\"3.4.8\",void 0),Object(i.g)(c,\"3.4.8\",\"esm2017\")}()}).call(this,n(8))},function(t,e){var n;n=function(){return this}();try{n=n||Function(\"return this\")()||(0,eval)(\"this\")}catch(t){\"object\"==typeof window&&(n=window)}t.exports=n},function(t,e,n){\"use strict\";n.r(e);var i=n(2);\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject(i.g)(\"firebase\",\"9.7.0\",\"app\");var s=n(5);Object(i.f)({apiKey:\"AIzaSyD9kBpuggn5GYDyZmyFZxCCcDrqf8rHg4c\",authDomain:\"demoproject-4ca45.firebaseapp.com\",projectId:\"demoproject-4ca45\",storageBucket:\"demoproject-4ca45.appspot.com\",messagingSenderId:\"494337793763\",appId:\"1:494337793763:web:c83f9c4cc11f56703cafd6\",measurementId:\"G-Q6RGGVY8DZ\"});var r=Object(s.f)(),o=Object(s.b)(r,\"recipes\");Object(s.e)(o).then(function(t){var e=[];t.docs.forEach(function(t){return e.push({title:t.data().title,author:t.data().author,id:t.id})}),console.log(e)}).catch(function(t){return console.log(t.message)});var a=document.querySelector(\".add\");a.addEventListener(\"submit\",function(t){t.preventDefault(),Object(s.a)(o,{title:a.title.value,author:a.author.value}).then(function(){return a.reset()})});var c=document.querySelector(\".delete\");c.addEventListener(\"submit\",function(t){t.preventDefault();var e=Object(s.d)(r,o,c.id);Object(s.c)(e).then(function(){return c.reset()})})},function(t,e){var n,i,s=t.exports={};function r(){throw new Error(\"setTimeout has not been defined\")}function o(){throw new Error(\"clearTimeout has not been defined\")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===r||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n=\"function\"==typeof setTimeout?setTimeout:r}catch(t){n=r}try{i=\"function\"==typeof clearTimeout?clearTimeout:o}catch(t){i=o}}();var c,u=[],h=!1,l=-1;function d(){h&&c&&(h=!1,c.length?u=c.concat(u):l=-1,u.length&&f())}function f(){if(!h){var t=a(d);h=!0;for(var e=u.length;e;){for(c=u,u=[];++l<e;)c&&c[l].run();l=-1,e=u.length}c=null,h=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}s.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new p(t,e)),1!==u.length||h||a(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title=\"browser\",s.browser=!0,s.env={},s.argv=[],s.version=\"\",s.versions={},s.on=g,s.addListener=g,s.once=g,s.off=g,s.removeListener=g,s.removeAllListeners=g,s.emit=g,s.prependListener=g,s.prependOnceListener=g,s.listeners=function(t){return[]},s.binding=function(t){throw new Error(\"process.binding is not supported\")},s.cwd=function(){return\"/\"},s.chdir=function(t){throw new Error(\"process.chdir is not supported\")},s.umask=function(){return 0}}]);","extractedComments":[]}